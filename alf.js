!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("lodash"),require("jquery"),require("backbone")):"function"==typeof define&&define.amd?define(["lodash","jquery","backbone"],t):"object"==typeof exports?exports.ALF=t(require("lodash"),require("jquery"),require("backbone")):e.ALF=t(e._,e.$,e.Backbone)}(this,function(e,t,i){return function(e){function t(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return e[n].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(1),s=i(n),r=t(2),a=i(r),o=t(8),l=i(o),u=t(10),d=i(u),h=t(11),f=i(h),c=t(9),p=t(14),g=i(p),m=t(20),v=i(m),_=t(26),E=i(_),w=t(56),y=i(w),T=t(59),b=i(T),M=t(60),C=i(M),P=t(25),S=i(P);exports["default"]={dom:a["default"],_:s["default"],hub:l["default"],Base:d["default"],View:f["default"],Events:c.Events,transition:g["default"],layer:v["default"],layout:E["default"],serialize:y["default"],compile:b["default"],nav:C["default"],util:S["default"]}},function(t,exports){t.exports=e},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0}),t(3),t(6),t(7);var n=t(4),s=i(n);exports["default"]=s["default"]},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function n(e){return"tagName"in e?e:e.parentNode}function s(e,t,i,n){var s=Math.abs(e-t),r=Math.abs(i-n);return s>=r?e-t>0?"Left":"Right":i-n>0?"Up":"Down"}function r(e){e=m[e],e.timeout&&clearTimeout(e.timeout),e.timeout=null}function a(){m.longTap.timeout=null,g.last&&(g.el.trigger("longTap"),g={})}function o(){m.active.timeout=null,g.last&&g.el.trigger("active")}function l(){r("longTap")}function u(){r("active")}function d(){var e,t,i,r,d,c=!1,v="ontouchstart"in window,_="touchstart",E="touchmove",w="touchend";v||(_="mousedown",E="mousemove",w="mouseup"),(0,p["default"])(document.body).bind(_,function(i){i=i.originalEvent||i,c=!0,d=v?i.touches[0]:i,e=Date.now(),t=e-(g.last||e),g.el=(0,p["default"])(n(d.target)),h&&clearTimeout(h),g.x1=d.pageX,g.y1=d.pageY,g.x2=d.pageX,g.y2=d.pageY,t>0&&250>=t&&(g.isDoubleTap=!0),g.last=e,m.longTap.timeout=setTimeout(a,m.longTap.delay),m.active.timeout=setTimeout(o,m.active.delay)}).bind(E,function(e){c&&(e=e.originalEvent||e,u(),l(),d=v?e.touches[0]:e,g.x2=d.pageX,g.y2=d.pageY,document.webkitPointerLockElement&&(c=!1))}).bind(w,function(e){c&&(c=!1,l(),u(),i=Math.abs(g.x1-g.x2),r=Math.abs(g.y1-g.y2),g.isDoubleTap?(g.el.trigger("doubleTap",g.el),g={}):i>30||r>30?(g.el.trigger("swipe")&&g.el.trigger("swipe"+s(g.x1,g.x2,g.y1,g.y2)),g={}):"last"in g&&7>i&&7>r&&(g.el.trigger("tap"),h=setTimeout(function(){h=null,g.el.trigger("singleTap"),g={}},250)))}).bind("touchcancel",function(){h&&clearTimeout(h),f&&clearTimeout(f),f=h=null,g={}})}var h,f,c=t(4),p=i(c),g={},m={longTap:{delay:750},active:{delay:0}};"undefined"!=typeof window&&(0,p["default"])(document).ready(d)},function(e,exports,t){"use strict";var $=t(5);e.exports=$},function(e,exports){e.exports=t},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function n(){var e=this[0],t=s.call(this);return e.offsetHeight+t}function s(){var e=r.call(this);return e.top+e.bottom}function r(){var e,t=this[0],i=window.getComputedStyle(t,null);return e={top:l(i,"margin-top"),right:l(i,"margin-right"),bottom:l(i,"margin-bottom"),left:l(i,"margin-left")},e.height=e.top+e.bottom,e.width=e.left+e.right,e}function a(){var e=this[0],t=window.getComputedStyle(e,null);return{top:l(t,"padding-top"),right:l(t,"padding-right"),bottom:l(t,"padding-bottom"),left:l(t,"padding-left")}}function o(){var e=this[0],t=e.getBoundingClientRect(),i=r.call(this),n=a.call(this);return{height:e.clientHeight,width:e.clientWidth,top:t.top,right:t.right,bottom:t.bottom,left:t.left,outerHeight:t.height+i.height,outerWidth:t.width+i.width,marginTop:i.top,marginRight:i.right,marginBottom:i.bottom,marginLeft:i.left,marginHeight:i.height,marginWidth:i.width,paddingTop:n.top,paddingRight:n.right,paddingBottom:n.bottom,paddingLeft:n.left,lineHeight:parseInt(d["default"].fn.css.call(this,"line-height"),10)}}function l(e,t){return parseInt(e.getPropertyValue(t),10)}var u=t(4),d=i(u);"undefined"!=typeof window&&(d["default"].fn.outerHeight=n,d["default"].fn.marginHeight=s,d["default"].fn.margin=r,d["default"].fn.padding=a,d["default"].fn.metrics=o)},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}/*!
	   * textFit.js
	   *
	   * Copyright 2011, Peter Rudolfsen
	   */
function n(e){return this.each(function(){var e=(0,r["default"])(this),t=t||1,i=(0,r["default"])('<span style="display:inline-block;margin:0;padding:0;"></span>').html(e.text()),n=parseInt(window.getComputedStyle(this).getPropertyValue("font-size"),10),s=e.width(),a=0;if(0!==s){for(e.empty().append(i),a=i.width(),a>=s&&(n=8,e.css("font-size",n+"px"),a=i.width());s>a;)n+=1,e.css("font-size",n+"px"),a=i.width(),s=e.width();a>=s&&(n-=1),e.css("font-size",n/t+"px")}})}var s=t(4),r=i(s);"undefined"!=typeof window&&(r["default"].fn.textFit=n)},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(1),s=i(n),r=t(9),a=i(r);exports["default"]=s["default"].extend({},a["default"].Events)},function(e,exports){e.exports=i},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(9),s=i(n),r=function(){this.initialize.apply(this,arguments)};r.prototype={initialize:function(){}},r.extend=s["default"].Model.extend,exports["default"]=r},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(9),s=i(n),r=t(12),a=i(r),o=t(13),l=i(o);exports["default"]=s["default"].View.extend({startX:0,startY:0,startScale:1,rotation:0,getSignature:function(){return this.signature||this.lockSignature(),this.signature},lockSignature:function(){this.signature=(0,l["default"])(this.el.outerHTML),this.innerSignature=(0,l["default"])(this.el.innerHTML)},matchesSignature:function(e){return e===this.signature},matchesInnerSignature:function(e){return e===this.innerSignature},matchesAnySignature:function(e){return this.matchesSignature(e)||this.matchesInnerSignature(e)},disable:function(){this.isDisabled=!0,this.$el.addClass(a["default"].IS_DISABLED)},enable:function(){this.isDisabled=!1,this.$el.removeClass(a["default"].IS_DISABLED)},isInDOM:function(){return null!==this.el.parentNode},startTransform:function(e){e.preventDefault(),e.stopPropagation(),this.startX=e.pageX,this.startY=e.pageY,this.startScale=e.scale,this.startRotation=e.rotation,e.currentTarget.classList.add("alf-is-moving")},transformEventTarget:function(e){this.transformElByEvent(e.currentTarget,e)},transformEl:function(e){this.transformElByEvent(this.el,e)},transformElByEvent:function(e,t){t.preventDefault(),t.stopPropagation(),t=t.originalEvent||t;var i=t.pageX-this.startX,n=t.pageY-this.startY,s=t.scale,r=t.rotation-this.startRotation;this.doTransform(e,{x:i,y:n,scale:s,rotation:r})},doTransform:function(e,t){var i="";i+="translate3d("+t.x+"px, "+t.y+"px, 1px)",t.rotation&&(i+="rotate("+t.rotation+"deg) "),i+="scale("+t.scale+") ",e.style.webkitTransition="none",e.style.webkitTransform=i},enableScrolling:function(e){e=e||{x:!0,y:!0};var t=[];e.x&&t.push("alf-is-scrollable-x"),e.y&&t.push("alf-is-scrollable-y"),this.$el.addClass(t.join(" "))},preventDefault:function(e){e.preventDefault()}})},function(e,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]={ALLOW_MULTIPLE:"alf-allow-multiple",ALLOW_OVERFLOW:"alf-allow-overflow",ASSET_STYLESHEET:"alf-asset-stylesheet",BREAK_BEFORE:"alf-break-before",BTN_GROUP:"alf-btn-group",CONTAINER:"alf-container",CONTAINER_FULLSCREEN:"alf-container-fullscreen",CONTAINER_INLINE:"alf-container-inline",CONTAINER_IS_UNLOADED:"alf-container-is-unloaded",CONTROLS_OFF:"alf-controls-off",FULLSCREEN_CONTENT:"alf-fullscreen-content",FULLSCREEN_EXIT:"alf-fullscreen-exit",FULLSCREEN_TOOLBAR:"alf-fullscreen-toolbar",MULTI_CHOICE:"alf-multiple-choices",IMAGE:"alf-image",IS_BREAKABLE:"alf-is-breakable",IS_DISABLED:"alf-is-disabled",IS_DRAGGABLE:"alf-is-draggable",IS_DRAGGABLE_X:"alf-is-draggable-x",IS_DRAGGABLE_Y:"alf-is-draggable-y",IS_EDITABLE:"alf-is-editable",IS_HIDDEN:"alf-is-hidden",IS_FIRST_BLOCK:"alf-block-is-first",IS_LAST_BLOCK:"alf-block-is-last",IS_NON_BREAKABLE:"alf-is-non-breakable",IS_NON_REARRANGEABLE:"alf-is-non-rearrangeable",IS_NON_SPLITTABLE:"alf-is-non-splittable",IS_OPTIONAL:"alf-is-optional",IS_PLAYING:"alf-is-playing",IS_REARRANGEABLE:"alf-is-rearrangeable",IS_REMOVABLE:"alf-is-removable",IS_REMOVED:"alf-is-removed",IS_RESPONSIVE:"alf-is-responsive",IS_RESIZABLE:"alf-is-resizable",IS_SPLITTABLE:"alf-is-splittable",IS_VISIBLE:"alf-is-visible",NO_SCORE:"alf-no-score",PAGENUM_X:function(e){return"alf-pagenum-"+e},PAGENUM_TOTAL_X:function(e){return"alf-pagenum-total-"+e},REVISION:function(e){return"alf-rev-"+e},REGION:"alf-region",REGION_FLEXIBLE:"alf-region-flexible",SIZE_DETECTOR:"alf-size-detector",STICK_TO_NEXT:"alf-stick-to-next",STRETCH_TO_FIT:"alf-stretch-to-fit",SUPPORTS_FULLSCREEN:"alf-supports-fullscreen",WIDGET:"alf-widget"}},function(e,exports){"use strict";function t(e,t){var i=e[0],o=e[1],l=e[2],u=e[3];i=n(i,o,l,u,t[0],7,-680876936),u=n(u,i,o,l,t[1],12,-389564586),l=n(l,u,i,o,t[2],17,606105819),o=n(o,l,u,i,t[3],22,-1044525330),i=n(i,o,l,u,t[4],7,-176418897),u=n(u,i,o,l,t[5],12,1200080426),l=n(l,u,i,o,t[6],17,-1473231341),o=n(o,l,u,i,t[7],22,-45705983),i=n(i,o,l,u,t[8],7,1770035416),u=n(u,i,o,l,t[9],12,-1958414417),l=n(l,u,i,o,t[10],17,-42063),o=n(o,l,u,i,t[11],22,-1990404162),i=n(i,o,l,u,t[12],7,1804603682),u=n(u,i,o,l,t[13],12,-40341101),l=n(l,u,i,o,t[14],17,-1502002290),o=n(o,l,u,i,t[15],22,1236535329),i=s(i,o,l,u,t[1],5,-165796510),u=s(u,i,o,l,t[6],9,-1069501632),l=s(l,u,i,o,t[11],14,643717713),o=s(o,l,u,i,t[0],20,-373897302),i=s(i,o,l,u,t[5],5,-701558691),u=s(u,i,o,l,t[10],9,38016083),l=s(l,u,i,o,t[15],14,-660478335),o=s(o,l,u,i,t[4],20,-405537848),i=s(i,o,l,u,t[9],5,568446438),u=s(u,i,o,l,t[14],9,-1019803690),l=s(l,u,i,o,t[3],14,-187363961),o=s(o,l,u,i,t[8],20,1163531501),i=s(i,o,l,u,t[13],5,-1444681467),u=s(u,i,o,l,t[2],9,-51403784),l=s(l,u,i,o,t[7],14,1735328473),o=s(o,l,u,i,t[12],20,-1926607734),i=r(i,o,l,u,t[5],4,-378558),u=r(u,i,o,l,t[8],11,-2022574463),l=r(l,u,i,o,t[11],16,1839030562),o=r(o,l,u,i,t[14],23,-35309556),i=r(i,o,l,u,t[1],4,-1530992060),u=r(u,i,o,l,t[4],11,1272893353),l=r(l,u,i,o,t[7],16,-155497632),o=r(o,l,u,i,t[10],23,-1094730640),i=r(i,o,l,u,t[13],4,681279174),u=r(u,i,o,l,t[0],11,-358537222),l=r(l,u,i,o,t[3],16,-722521979),o=r(o,l,u,i,t[6],23,76029189),i=r(i,o,l,u,t[9],4,-640364487),u=r(u,i,o,l,t[12],11,-421815835),l=r(l,u,i,o,t[15],16,530742520),o=r(o,l,u,i,t[2],23,-995338651),i=a(i,o,l,u,t[0],6,-198630844),u=a(u,i,o,l,t[7],10,1126891415),l=a(l,u,i,o,t[14],15,-1416354905),o=a(o,l,u,i,t[5],21,-57434055),i=a(i,o,l,u,t[12],6,1700485571),u=a(u,i,o,l,t[3],10,-1894986606),l=a(l,u,i,o,t[10],15,-1051523),o=a(o,l,u,i,t[1],21,-2054922799),i=a(i,o,l,u,t[8],6,1873313359),u=a(u,i,o,l,t[15],10,-30611744),l=a(l,u,i,o,t[6],15,-1560198380),o=a(o,l,u,i,t[13],21,1309151649),i=a(i,o,l,u,t[4],6,-145523070),u=a(u,i,o,l,t[11],10,-1120210379),l=a(l,u,i,o,t[2],15,718787259),o=a(o,l,u,i,t[9],21,-343485551),e[0]=f(i,e[0]),e[1]=f(o,e[1]),e[2]=f(l,e[2]),e[3]=f(u,e[3])}function i(e,t,i,n,s,r){return t=f(f(t,e),f(n,r)),f(t<<s|t>>>32-s,i)}function n(e,t,n,s,r,a,o){return i(t&n|~t&s,e,t,r,a,o)}function s(e,t,n,s,r,a,o){return i(t&s|n&~s,e,t,r,a,o)}function r(e,t,n,s,r,a,o){return i(t^n^s,e,t,r,a,o)}function a(e,t,n,s,r,a,o){return i(n^(t|~s),e,t,r,a,o)}function o(e){var i,n=e.length,s=[1732584193,-271733879,-1732584194,271733878];for(i=64;i<=e.length;i+=64)t(s,l(e.substring(i-64,i)));e=e.substring(i-64);var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(i=0;i<e.length;i++)r[i>>2]|=e.charCodeAt(i)<<(i%4<<3);if(r[i>>2]|=128<<(i%4<<3),i>55)for(t(s,r),i=0;16>i;i++)r[i]=0;return r[14]=8*n,t(s,r),s}function l(e){var t,i=[];for(t=0;64>t;t+=4)i[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return i}function u(e){for(var t="",i=0;4>i;i++)t+=c[e>>8*i+4&15]+c[e>>8*i&15];return t}function d(e){for(var t=0;t<e.length;t++)e[t]=u(e[t]);return e.join("")}function h(e){return d(o(e))}function f(e,t){return e+t&4294967295}Object.defineProperty(exports,"__esModule",{value:!0});var c="0123456789abcdef".split("");exports["default"]=h},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(15),s=i(n),r=t(16),a=i(r),o=t(17),l=i(o),u=t(18),d=i(u),h=t(19),f=i(h);exports["default"]={Dispatcher:s["default"],Appear:a["default"],Clip:l["default"],Fade:d["default"],Scale:f["default"]}},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(10),s=i(n),r=t(9),a=i(r),o=t(1),l=i(o),u=t(2),d=i(u),h=Math,f=s["default"].extend();l["default"].extend(f.prototype,a["default"].Events,{initialize:function(e){e=this.options=l["default"].extend({},e||{}),l["default"].bindAll(this,"stopRunning"),this.isReset=!1,this._isRunning=!1,this._isReversible=!1,e.target&&this.setTarget(e.target),e.to&&this.setTo(e.to)},setTarget:function(e){this.target=l["default"].defaults(e,{el:null,width:null,height:null,top:null,left:null}),this.calcMetrics()},setTargetEl:function(e){this.setTarget({el:e})},setTo:function(e){this.to=l["default"].defaults(e,{el:null,width:null,height:null})},isRunning:function(){return this._isRunning},stopRunning:function(){this._isRunning=!1},calcMetrics:function(){var e,t;e=this.target,t=this.to,e=l["default"].extend(e,e.el.getBoundingClientRect()),t=l["default"].extend(t,{width:t.el.clientWidth,height:t.el.clientHeight}),t.scaleX=e.width/t.width,t.scaleY=e.height/t.height,t.scale=h.max(t.scaleX,t.scaleY),e.scaleX=t.width/e.width,e.scaleY=t.height/e.height,e.scale=h.min(e.scaleX,e.scaleY),this.offsetX=h.round(e.left+(e.width-t.width)/2),this.offsetY=h.round(e.top+(e.height-t.height)/2),t.maskHeight=h.round(e.height/t.scale),t.maskWidth=h.round(e.width/t.scale),t.clipHeight=t.height-t.maskHeight,t.clipWidth=t.width-t.maskWidth},reset:function(){var e=this.to,t=this.options.effect.animateFromProps.call(this);e.el.style.webkitTransitionDuration="0ms",e.el.style.mozTransitionDuration="0ms",e.el.style.msTransitionDuration="0ms",e.el.style.oTransitionDuration="0ms",e.el.style.transitionDuration="0ms";for(var i in t)-1===i.toLowerCase().indexOf("transition")&&(e.el.style[i]=t[i])},run:function(e){if(this._isRunning)return!1;this._isRunning=!0,this._isReversible=!0;var t=this,i=this.target,n=this.to,s=function(){t._animate(e)};if(!this.options.upscaleTarget||!i||!i.el)return void this.trigger("willAppear",this,s);i.el.classList.add("alf-is-moving");var r="",a=n.width/2-i.width/2-i.left,o=n.height/2-i.height/2-i.top;r+="translate3d("+a+"px, "+o+"px, 1px) ",r+="scale("+i.scale+") ",(0,d["default"])(i.el).one("webkitTransitionEnd",l["default"].bind(this._onScaleEnd,this,e)),(0,d["default"])(i.el).one("transitionend",l["default"].bind(this._onScaleEnd,this,e)),i.el.style.webkitTransition="-webkit-transform ease-out 300ms",i.el.style.transition="transform ease-out 300ms",i.el.style.webkitTransform=r,i.el.style.transform=r},reverse:function(e){var t=this.options.effect;if(this._isRunning||!this._isReversible)return!1;this._isRunning=!0;var i=this.to,n=(t.reverseProps||t.animateFromProps).call(this);(0,d["default"])(i.el).one("webkitTransitionEnd",l["default"].bind(this._onReverseEnd,this,e)),(0,d["default"])(i.el).one("transitionend",l["default"].bind(this._onReverseEnd,this,e));for(var s in n)i.el.style[s]=n[s]},reverseTo:function(e,t){this.to={el:e},this.calcMetrics(),this.reverse(t)},_animate:function(e){var t=this.to,i=this.options.effect.animateToProps.call(this);this.reset(),this.trigger("ready",this),(0,d["default"])(t.el).one("webkitTransitionEnd",l["default"].bind(this._onAnimateEnd,this,e)),(0,d["default"])(t.el).one("transitionend",l["default"].bind(this._onAnimateEnd,this,e)),l["default"].each(i,function(e,i){t.el.style[i]=e})},_onAnimateEnd:function(e){var t;this.to&&this.to.el&&(this.to.el.style.removeProperty("-webkit-transition"),this.to.el.style.removeProperty("transition")),this.target&&this.target.el&&(t=this.target.el.style,t.removeProperty("-webkit-transform"),t.removeProperty("-webkit-transition"),t.removeProperty("transform"),t.removeProperty("transition"),(0,d["default"])(this.target.el).removeClass("alf-is-moving")),e&&e.call(this,this),this.trigger("didAppear",this),setTimeout(this.stopRunning,100)},_onReverseEnd:function(e){this._isReversible=!1,this.to.el.style.webkitTransition="none",this.to.el.style.webkitTransform="none",this.to.el.style.mozTransition="none",this.to.el.style.mozTransform="none",this.to.el.style.msTransition="none",this.to.el.style.msTransform="none",this.to.el.style.oTransition="none",this.to.el.style.oTransform="none",this.to.el.style.transition="none",this.to.el.style.transform="none",e&&e.call(this,this),this.trigger("didDisappear",this),setTimeout(this.stopRunning,100)},_onScaleEnd:function(e){var t=this,i=function(){t._animate(e)};this.trigger("willAppear",this,i)}}),exports["default"]=f},function(e,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t={reverseProps:function(){return{webkitTransition:"-webkit-transform ease-out 300ms",webkitTransform:"translate3d(-1500px, -1500px, 0) scale(0.4)"}},animateFromProps:function(){var e="";return e+="scaleX(0.8) scaleY(0.8) ",{webkitTransition:"-webkit-transform ease-out 300ms, opacity ease-out 300ms",webkitTransform:e,opacity:0}},animateToProps:function(){return{webkitTransition:"-webkit-transform ease-out 300ms, opacity ease-out 300ms",webkitTransform:"translate3d(0, 0, 0) scaleX(1) scaleY(1)",opacity:1}}};exports["default"]=t},function(e,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=Math;exports["default"]={animateFromProps:function(){var e="",i=this.to,n=t.round(this.clipHeight/2),s=i.height-n,r=t.round(this.clipWidth/2),a=i.width-r;return e+="translate3d("+this.offsetX+"px, "+this.offsetY+"px, 0px) ",e+="scale("+this.to.scale+") ",{webkitTransition:"-webkit-transform ease-out 300ms, clip ease-out 300ms",webkitTransform:e,clip:"rect("+n+"px, "+a+"px, "+s+"px, "+r+"px) "}},animateToProps:function(){var e=this.to;return{webkitTransition:"-webkit-transform ease-out 300ms, clip ease-out 300ms",webkitTransform:"translate3d(0, 0, 0) scaleX(1) scaleY(1)",clip:"rect(0px, "+e.width+"px, "+e.height+"px, 0px)"}}}},function(e,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t={animateFromProps:function(){return{webkitTransition:"opacity ease-out 300ms",mozTransition:"opacity ease-out 300ms",msTransition:"opacity ease-out 300ms",oTransition:"opacity ease-out 300ms",transition:"opacity ease-out 300ms",opacity:0}},animateToProps:function(){return{webkitTransition:"opacity ease-out 300ms",mozTransition:"opacity ease-out 300ms",msTransition:"opacity ease-out 300ms",oTransition:"opacity ease-out 300ms",transition:"opacity ease-out 300ms",opacity:1}}};exports["default"]=t},function(e,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t={animateFromProps:function(){var e="";return e+="translate3d("+this.offsetX+"px, "+this.offsetY+"px, 0px) ",e+="scaleX("+this.scaleX+") scaleY("+this.scaleY+") ",{webkitTransition:"-webkit-transform ease-out 300ms, opacity ease-out 200ms",webkitTransform:e,opacity:0}},animateToProps:function(){return{webkitTransition:"-webkit-transform ease-out 300ms, opacity ease-out 200ms",webkitTransform:"translate3d(0, 0, 0) scaleX(1) scaleY(1)",opacity:1}}};exports["default"]=t},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(21),s=i(n),r=t(22),a=i(r),o=t(23),l=i(o),u=t(24),d=i(u);exports["default"]={Manager:s["default"],View:a["default"],Page:l["default"],Fullscreen:d["default"]}},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(10),s=i(n);exports["default"]=s["default"].extend({initialize:function(){this.layers=[],this.length=0},add:function(e){return this.layers.push(e),this.length=this.layers.length,this},remove:function(e){var t=this.layers;return t.splice(t.indexOf(e),1),this.length=this.layers.length,this},at:function(e){return this.layers[e]},getPos:function(e){return this.layers.indexOf(e)},getLayerAbove:function(e){return this.at(this.getPos(e)+1)},getLayerBelow:function(e){return this.at(this.getPos(e)-1)}})},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(1),s=i(n),r=t(11),a=i(r),o=t(14),l=i(o),u=t(12),d=i(u),h=a["default"].extend();s["default"].extend(h.prototype,{initialize:function(e){e&&e.manager&&(this.manager=e.manager,this.manager.add(this))},tearDown:function(){this.stopListening()},show:function(){return this.$el.removeClass(d["default"].IS_HIDDEN),this},hide:function(){return this.$el.addClass(d["default"].IS_HIDDEN),this},above:function(){return this.manager.getLayerAbove(this)},below:function(){return this.manager.getLayerBelow(this)},minimize:function(){var e=this,t=this.below();return t.show(),t.transition.reverse(function(){e.hide()}),this},transitionTo:function(e,t,i){return this._createTransition({layer:e,target:i,effect:t,upscaleTarget:!1})},scaleTo:function(e,t,i){return this._createTransition({layer:e,target:i,effect:t,upscaleTarget:!0})},transitionToLayerAbove:function(e,t){return this.transitionTo(this.above(),e,t)},transitionToLayerBelow:function(e,t){return this.transitionTo(this.below(),t,e)},_createTransition:function(e){e.to={el:e.layer.el};var t=new l["default"].Dispatcher(e);return this.listenTo(t,"didDisappear",function(t){e.layer.$el.addClass(d["default"].IS_HIDDEN)}),this.listenTo(t,"ready",function(){e.layer.$el.removeClass(d["default"].IS_HIDDEN)}),t}});var f=h.prototype;f.getLayerBelow=f.below,f.getLayerAbove=f.above,exports["default"]=h},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(1),s=i(n),r=t(22),a=i(r),o=a["default"].extend();s["default"].extend(o.prototype,{render:function(){return this}}),exports["default"]=o},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(1),s=i(n),r=t(2),a=i(r),o=t(22),l=i(o),u=t(12),d=i(u),h=t(25),f=i(h),c=t(8),p=i(c),g=l["default"].extend();s["default"].extend(g.prototype,{fullscreenEvents:{touch:{touchstart:"_onTouchStart",singleTap:"toggleControls","tap .alf-fullscreen-exit":"exitFullscreen",doubleTap:"exitFullscreen",touchend:"preventDefault"},pointer:{mouseover:"showControls",mouseout:"hideControls","click .alf-fullscreen-exit":"exitFullscreen",dblclick:"exitFullscreen"}},initialize:function(e){e=this.options=s["default"].extend({},e||{}),s["default"].bindAll(this,"_onScroll"),g.__super__.initialize.apply(this,s["default"].toArray(arguments)),this.position=this.$el.css("position"),this.listenTo(p["default"],"fullscreenWillAppear",this._fullscreenWillAppear),e.resizeToWindow=void 0===e.resizeToWindow?!0:e.resizeToWindow,this.delegateEvents(f["default"].touchScreen?this.fullscreenEvents.touch:this.fullscreenEvents.pointer)},tearDown:function(){this.stopListening(),this.$el.empty()},render:function(){return this},renderFullscreenContainer:function(e){var t,i,n=new RegExp("\\s?"+d["default"].REVISION("")+"[^\\s]*");return this.el.className=this.el.className.replace(n,""),i=(0,a["default"])("<div>").addClass(d["default"].BTN_GROUP),i.append((0,a["default"])("<button>").addClass(d["default"].FULLSCREEN_EXIT)),this.$toolbar=(0,a["default"])("<div>").addClass(d["default"].FULLSCREEN_TOOLBAR),this.$toolbar.append(i),this.$content=(0,a["default"])("<div>").addClass(d["default"].FULLSCREEN_CONTENT),this.$content.append(e.el),t=document.createDocumentFragment(),t.appendChild(this.$toolbar[0]),t.appendChild(this.$content[0]),this.$el.empty().removeClass(d["default"].CONTROLS_OFF).addClass(d["default"].REVISION(e.options.revision)).append(t),this.options.resizeToWindow||this.metrics||this._calculateMetrics(),this},toggleControls:function(){this.$el.toggleClass(d["default"].CONTROLS_OFF)},showControls:function(){this.$el.removeClass(d["default"].CONTROLS_OFF)},hideControls:function(){this.$el.addClass(d["default"].CONTROLS_OFF)},exitFullscreen:function(e){e&&(e.stopPropagation(),e.preventDefault());var t=this.below();return this.gestureStarted||t.transition.isRunning()?!1:((0,a["default"])(window).off("mousewheel",this._onMouseWheelScroll).off("scroll touchmove touchend",this._onScroll),t.transition.reverse(),void p["default"].trigger("fullscreenWillDisappear"))},_calculateMetrics:function(){this._windowHeight=window.innerHeight,this._windowWidth=window.innerWidth,this.metrics=this.$el.metrics()},_onTouchStart:function(e){var t,i=(0,a["default"])(e.target);t=i.css("overflow"),"scroll"!==t&&"auto"!==t&&e.preventDefault()},_onGestureStart:function(e){return this.gestureStarted||this.below().transition.isRunning()?!1:(this.gestureStarted=!0,void this.startTransform(e))},_onGestureChange:function(e){return this.below().transition.isRunning()?!1:void this.transformEventTarget(e)},_onGestureEnd:function(e){var t=this.below();return t.transition.isRunning()?!1:(t.transition.reverse(),void(this.gestureStarted=!1))},_fullscreenWillAppear:function(e){var t;if(t={},this.options.resizeToWindow&&(t.width=window.innerWidth+"px",t.height=window.innerHeight+"px"),"fixed"!==this.position){this.x=window.pageXOffset,this.y=window.pageYOffset;var i="translate("+this.x+"px, "+this.y+"px)";t[f["default"].prefixStyle("transform")]=i,t.transform=i}this.$el.css(t),(0,a["default"])(window).on("mousewheel",this._onMouseWheelScroll).on("scroll touchmove touchend",this._onScroll)},_onMouseWheelScroll:function(e){e.preventDefault()},_onScroll:function(e){if("fixed"!==this.position&&(this.y!==window.pageYOffset||this.x!==window.pageXOffset)){this.y=window.pageYOffset,this.x=window.pageXOffset;var t="translate("+this.x+"px, "+this.y+"px)",i={transform:t};i[f["default"].prefixStyle("transform")]=t,this.$el.css(i)}}}),exports["default"]=g},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function n(e){return function(){console[e].apply(console,[].slice.call(arguments))}}Object.defineProperty(exports,"__esModule",{value:!0});var s=t(1),r=i(s),a="undefined"!=typeof window,o={touchScreen:a&&"ontouchstart"in window,getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},getVendorPrefix:r["default"].memoize(function(e){var t=["","webkit","moz","ms"];return e=o.camelize(e),r["default"].find(t,function(t){return void 0!==document.body.style[t+e]})}),prefixStyle:function(e,t){var i=o.getVendorPrefix(e);return t?i+o.camelize(e):"-"+i+"-"+e},camelize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},matchMedia:"undefined"!=typeof window&&window.matchMedia&&r["default"].bind(window.matchMedia,window)};o.dom={getFieldMap:function(e){var t=e.getAttribute("data-map");return t?t.split(" "):[]},getMediaQuery:function(e){return e.getAttribute("data-media")}},a&&!window.console&&(window.console={}),a&&!window.console.log&&r["default"].each(["log","warning","error","info"],function(e){window.console[e]=function(){return{}}}),o.console={log:n("log"),warn:n("warn"),error:n("error"),info:n("info"),debug:n("debug"),groupCollapsed:n("groupCollapsed"),group:n("group"),groupEnd:n("groupEnd")},exports["default"]=o},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(27),s=i(n),r=t(35),a=i(r),o=t(52),l=i(o),u=t(51),d=i(u),h=t(55),f=i(h),c=t(36),p=i(c);exports["default"]={Article:s["default"],Page:a["default"],Template:l["default"],TemplateManager:d["default"],Content:f["default"],Format:p["default"]}},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(exports,"__esModule",{value:!0});var s=t(2),r=i(s),a=t(1),o=i(a),l=t(25),u=i(l),d=t(11),h=i(d),f=t(28),c=i(f),p=t(33),g=i(p),m=t(34),v=i(m),_=t(36),E=i(_),w=t(12),y=i(w),T=t(51),b=i(T),M=t(35),C=i(M),P=t(55),S=i(P),O=h["default"].extend();o["default"].extend(O.prototype,g["default"],c["default"],{initialize:function(e){e=this.options=o["default"].extend({revision:"no-rev"},e||{}),o["default"].bindAll(this,"render"),this.templates=null,this.overrideTemplates={},this.layer=e.layer||null,this.fullscreenLayer=e.fullscreenLayer||this.layer&&this.layer.above()||null,this.pages={},this.numberOfPages=0,this.format=e.format||null,this.defaultMetrics(e.metrics),e.content&&this.setContent(e.content),this.setupWidgets(e),e.templates&&this.setTemplates(e.templates)},tearDown:function(){o["default"].invoke(this.pages,"tearDown")},render:function(){return this},discard:function(){o["default"].invoke(this.pages,"tearDown"),this.pages={},this.overrideTemplates={},this.numberOfPages=0},compile:function(){var e=new v["default"](this);return e.compile()},decompile:function(e){var t=new v["default"](this);return t.decompile(e),this},setTemplates:function(e){var t=this.templates||[];return e=b["default"].getEligibleTemplatesForArticle(this,e),t&&t.length?void(this.templates=o["default"].map(e,function(e){var i=o["default"].find(t,function(t){return t.name===e.name});return i&&(i.setElement(e.el),this._reloadPagesUsingTemplate(i)),i||e},this)):void(this.templates=e)},_reloadPagesUsingTemplate:function(e){o["default"].each(this.pages,function(t){t.template===e&&(t.template=null,t.setTemplateIfUsable(e))})},setTemplateForPageNum:function(e,t){this.overrideTemplates[t]=e,this.pages[t]&&(this.pages[t].hasOverrideTemplate=!0)},revert:function(e){for(var t in this.pages)e>t||!this.pages[t]||this.pages[t].revert()},reflow:function(e){o["default"].each(["prepareToReflow","reflow"],function(t){for(var i in this.pages)e>i||!this.pages[i]||this.pages[i][t]()},this)},renderPage:function(e,t){var i,n;return this._calcContentMetrics(e),i=o["default"].isObject(t)?t:this._getOrCreatePageForPageNum(t),n=this.overrideTemplates[i.pageNum],i.prepareToRender(),e.innerHTML="",(0,r["default"])(e).append(i.el),i.render(),i.hasOverrideTemplate=!(!n||n!==i.template),i},renderPages:function(e,t){var i;for(t=t||0,this._calcContentMetrics(e);!this.content.isEmpty()&&(i=this._doRenderPage(e,t));)this.pages[t]=i,t+=1;return this.numberOfPages=this.getNumberOfPagesInUse(),o["default"].invoke(this.pages,"allPagesDidRender",this.numberOfPages),this},getNumberOfPagesInUse:function(){var e=0;for(var t in this.pages)this.pages[t].pageTemplate.didRetainElements()?e+=1:(this.pages[t].tearDown(),delete this.pages[t]);return e},setContent:function(e){if(e instanceof S["default"])this.content=e;else{if(!o["default"].isPlainObject(e))throw new Error("Unsupported data in setContent: "+("undefined"==typeof e?"undefined":n(e)));this.content=new S["default"](e)}},findContainerInElement:function(e){var t,i;return i=(0,r["default"])(e),i=i.is("."+y["default"].CONTAINER)?i:i.find("."+y["default"].CONTAINER),i.length?(o["default"].each(this.pages,function(e){return t=o["default"].find(e.pageTemplate.containers,function(e){return e.el===i[0]}),t?!1:void 0}),t):!1},_getOrCreatePageForPageNum:function(e){var t=this.pages[e],i=this.overrideTemplates[e];return t||(t=this.createPage(e)),t.rendered?t:(t.scoredTemplates=b["default"].getScoredTemplatesForPage(t,this.templates.slice(0)),t.templates=o["default"].pluck(t.scoredTemplates,"template"),i&&t.setTemplateIfUsable(i)||t.setupBestTemplate()?t:!1)},createPage:function(e){var t=this.metrics;return new C["default"]({className:this.content.className,content:this.content,layer:this.layer,fullscreenLayer:this.fullscreenLayer,widgets:this.widgets,fullscreenWidgets:this.fullscreenWidgets,pageNum:e,format:this.format,revision:this.options.revision,metrics:{height:t.height,width:t.width,lineHeight:t.lineHeight}})},_doRenderPage:function(e,t){for(var i,n=0;;){if(i=this._getOrCreatePageForPageNum(t),!i)return!1;if(this.renderPage(e,i),i.pageTemplate.didRetainElements())return i;if(u["default"].console.warn("Page "+t+" did not retain any elements on attempt "+n,"left:",this.content.elementsLeft),n+=1,n>1||!this.overrideTemplates[t])return u["default"].console.warn("stopped trying after "+n+" attempts"),!1;this.overrideTemplates[t]=null}},_getSampleTemplate:function(){var e=0;return o["default"].find(this.templates,function(t){return t.regions&&t.regions.length>e})},_calcContentMetrics:function(e){if(!this.hasCalculatedMetrics){this.setMetrics((0,r["default"])(e).metrics()),this.format&&this.format instanceof E["default"]&&(this.metrics.height=this.format.get("height"),this.metrics.width=this.format.get("width"));var t,i=this._getSampleTemplate();if(!i)return void u["default"].console.warn("No sample template found. Failed to precalculate metrics for ",this);i=b["default"].getPageTemplateFromTemplate(i),t=i.regions,i.$el.css("visibility","hidden"),i.$el.addClass(y["default"].REVISION(this.options.revision)),e.appendChild(i.el),this._calcBlockMetrics(t[0].el),e.removeChild(i.el),t[0].$el.empty(),this.hasCalculatedMetrics=!0}},_calcBlockMetrics:function(e){var t=this.content.getBlocks(),i=document.createDocumentFragment();o["default"].each(t,function(e){i.appendChild(e.render().el)}),e.appendChild(i),o["default"].each(t,function(e){e.calculateMetrics()})}}),exports["default"]=O},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(1),s=i(n),r=t(29),a=i(r),o=t(30),l=i(o);exports["default"]={setupWidgets:function(e){var t;this.widgets=e.widgets,e.widgets instanceof a["default"]||(this.widgets=new a["default"](l["default"]),t=s["default"].isArray(e.widgets),s["default"].each(e.widgets,function(e,i){this.widgets.add(e,t?void 0:i)},this))}}},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(10),s=i(n),r=t(1),a=i(r),o=s["default"].extend({initialize:function(e){this.widgets=[],a["default"].isPlainObject(e)&&a["default"].each(e,function(e,t){this.add(e,t)},this)},add:function(e,t){this.widgets.push(this.normalize(e,t))},normalize:function(e,t){if("function"==typeof e&&(e={run:e}),a["default"].defaults(e,{compile:!1,render:function(){},run:function(e){e()},fullscreen:function(e,t){t()},selector:t}),!e.selector)throw new Error("Failed to normalize widget. No selector found!");return e},getMatchesForContainer:function(e){var t=[];return this.each(function(i){var n=e.$el.is(i.selector)?e.$el:e.$el.find(i.selector);n.length&&t.push({container:e,widget:i,$el:n,el:n[0]})},this),t}});a["default"].each(["each","map","isEmpty","filter"],function(e){o.prototype[e]=function(){var t=Array.prototype.slice.call(arguments);return t.unshift(this.widgets),a["default"][e].apply(a["default"],t)}}),exports["default"]=o},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){var i=(0,r["default"])('<div class="alf-slideshow-nav">'),n=(0,r["default"])('<a class="alf-slideshow-nav-next"></a>'),s=(0,r["default"])('<a class="alf-slideshow-nav-prev"></a>');i.append(s).append(n),e.append(i),s.on("dblclick",!1),n.on("dblclick",!1),s.on("click",function(){return t.gotoPrevPage(),!1}),n.on("click",function(){return t.gotoNextPage(),!1});var a=t.options.numberOfPages;s.addClass("alf-is-hidden"),t.on("pageWillAppear",function(e,t){0===t?s.addClass("alf-is-hidden"):t>0&&a-1>t?(s.removeClass("alf-is-hidden"),n.removeClass("alf-is-hidden")):t===a-1&&n.addClass("alf-is-hidden")})}Object.defineProperty(exports,"__esModule",{value:!0});var s=t(2),r=i(s),a=t(25),o=i(a),l=t(31),u=i(l);
exports["default"]={".alf-slideshow":{compile:!0,render:function(){var e,t,i;e=(0,r["default"])("<div>").css({position:"relative",top:0,left:0}),t=(0,r["default"])("<div>").addClass("alf-slideshow-toggle alf-fullscreen-toggle alf-is-draggable"),this.$el.children(":not(:first-child)").remove(),e.append(t).append(this.$el),i=(0,r["default"])("<div>").addClass("alf-slideshow-stack"),this.$el.addClass("alf-slideshow-inline").prepend(i.clone().addClass("alf-slideshow-stack-1")).prepend(i.clone().addClass("alf-slideshow-stack-2")),this.container.$el.append(e)},run:function(e){var t=this.container.$el.find(".alf-slideshow-toggle");t.length&&"none"!==t.css("display")&&this.container.preventDefaultEvents(),this.container.$el.on(o["default"].touchScreen?"tap":"click",".alf-fullscreen-toggle",this.container.enterFullscreen).on("touchend",".alf-fullscreen-toggle",function(e){e.preventDefault()}),e()},fullscreen:function(e,t){var i,s,a,l;a=e.$el.find(".alf-slideshow").children().clone(),l=a.length,s=(0,r["default"])('<button class="alf-slideshow-progress"></button>'),s.text("1/"+l),e.layer.$toolbar.append(s),i=(0,r["default"])('<div class="alf-slideshow"><div class="alf-pages"><div class="alf-page alf-page-1"><section class="alf-page-loader swiper-page-is-loading"></section><section class="alf-page-content"></section></div><div class="alf-page alf-page-2"><section class="alf-page-loader swiper-page-is-loading"></section><section class="alf-page-content"></section></div><div class="alf-page alf-page-3"><section class="alf-page-loader swiper-page-is-loading"></section><section class="alf-page-content"></section></div></div></div>'),e.$el.empty().append(i);var d=new u["default"](i[0],{numberOfPages:a.length,enableKeyNavigation:!0});d.on("pageWillRender",function(e,t){(0,r["default"])(e).empty().append(a[t])}),d.on("pageWillAppear",function(e,t){s.text(t+1+"/"+l)}),d.start(),o["default"].touchScreen||n(e.layer.$content,d),t()}},".alf-stretch-to-fit h1":{compile:!0,render:function(){this.$el.textFit()}}}},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(32),s=i(n);exports["default"]=s["default"]},function(e,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=5,i=["_onMove","_onMoveStart","_onMoveEnd","_onMoveStartCapture","_onMoveCapture","_onMoveEndCapture","_onTransitionEnd","_onKeyPress","_refresh","_renderPages"],n=Array.prototype.slice,s=function(e,t,i){return n.call(e).forEach(t,i)},r=function(e,t){var n=this,r=e.children[0];i.forEach(function(e){n[e]=n[e].bind(n)}),this.el=e,this.elements={pageContainer:r,pages:[],scrollablePages:[]},s(r.children,function(e,t){this.elements.pages.push({el:e,offset:100*t,pageNum:t}),e.classList.contains("is-scrollable")&&this.elements.scrollablePages.push(e)},this),this.concurrentPages=this.elements.pages.length,t=t||{},t.overflowScrolling=t.overflowScrolling||!1,t.renderDeferTime=t.renderDeferTime||200,t.scrollDuration=t.scrollDuration||320,t.tapToFlip=t.tapToFlip||!1,t.loadingClass=t.loadingClass||"swiper-page-is-loading",t.enableKeyNavigation=void 0===t.enableKeyNavigation?!0:t.enableKeyNavigation,this.options=t,this.events={},this.renderTimeout=null,this.pageFlipWidth=50,this.x=0,this.currentPage=0};r.prototype={start:function(){this.pageWidth=this.elements.pages[0].el.clientWidth,this.windowWidth=window.innerWidth,this._renderPages(),this.enable()},gotoPage:function(e,t,i){var n,s,r=this,a=this.x||0;t=void 0!==t?t:this.options.scrollDuration,i=0===t?!1:i,e=parseInt(e,10),clearTimeout(this.renderTimeout),0>e||isNaN(e)||0===this.options.numberOfPages?e=0:e>this.options.numberOfPages-1&&(e=this.options.numberOfPages-1),this.prevPage=this.currentPage,this.currentPage=e,e>0&&e<this.options.numberOfPages-1&&this._positionPages(),this.x=e*this.pageWidth*-1,this._moveX(this.elements.pageContainer,this.x+"px",t),i&&a!==this.x||this._onPageChange(!0),this.prevPage!==this.currentPage&&(n=this.elements.pages[e%this.concurrentPages],r.trigger("pageWillAppear",n.el.children[1],e),s=this.elements.pages[this.prevPage%this.concurrentPages],r.trigger("pageWillDisappear",s.el.children[1],this.prevPage))},on:function(e,t,i){var n=this.events[e]||(this.events[e]=[]);n.push({callback:t,context:i||this})},trigger:function(e){var t,i=this.events[e];if(i){t=n.call(arguments,1);for(var s in i)i[s].callback.apply(i[s].context,t)}},enable:function(){var e=this.elements.pageContainer;this._disableOverflowScrolling(),e.addEventListener("touchstart",this._onMoveStartCapture,!0),e.addEventListener("webkitTransitionEnd",this._onTransitionEnd,!0),e.addEventListener("transitionend",this._onTransitionEnd,!0),window.addEventListener("keydown",this._onKeyPress,!1),window.addEventListener("resize",this._refresh,!0)},disable:function(){this._enableOverflowScrolling(),this.elements.pageContainer.addEventListener("touchstart",this._onMoveStartCapture,!0),window.removeEventListener("keydown",this._onKeyPress,!1),window.removeEventListener("resize",this._refresh,!0)},gotoCurrentPage:function(e){this.gotoPage(this.currentPage,e)},gotoPrevPage:function(){this.gotoPage(this.currentPage-1,this.options.scrollDuration)},gotoNextPage:function(){this.gotoPage(this.currentPage+1,this.options.scrollDuration)},refresh:function(e){s(this.elements.pages,function(e){e.prevPage=void 0}),e=e||{};for(var t in e)this.options[t]=e[t];this.trigger("refresh"),this.gotoPage(this.currentPage,void 0,!1)},reset:function(e){this.prevPage=void 0,s(this.elements.pages,function(e){e.prevPage=void 0===e.prevPage?void 0:null,e.pageNum=null}),e=e||{};for(var t in e)this.options[t]=e[t];this.trigger("refresh"),this.gotoPage(0,0,!1)},_positionPages:function(){var e=this,t=this.currentPage,i=(this.concurrentPages-1)/2,n=t-i,s=t+i;n=0>n?0:n,s=s<this.options.numberOfPages?s:this.options.numberOfPages-1;for(var r=n;s>=r;r++){var a=this.elements.pages[r%this.concurrentPages],o=100*r,l=a.el.children[0];a.prevOffset=void 0===a.offset?o:a.offset,a.offset=o,a.prevOffset!==a.offset&&(l.classList.add(e.options.loadingClass),this._moveX(a.el,a.offset+"%"))}},_renderPage:function(e,t){var i=e.el.children[1],n=void 0===e.prevPage;e.prevPage=e.pageNum,e.pageNum=t,(n||e.prevPage!==e.pageNum)&&(i.scrollTop=0,i.scrollLeft=0,n||this.trigger("pageWillDestruct",i,e.prevPage),this.trigger("pageWillRender",i,t)),e.el.children[0].classList.remove(this.options.loadingClass)},_renderPages:function(){for(var e,t,i=this,n=this.currentPage,s=n,r=this.options,a=this.elements.pages,o=n<=this.prevPage?1:-1,l=0;l<this.concurrentPages;l++)s+=l*o,o*=-1,e=a[s%this.concurrentPages],!e||s>r.numberOfPages-1||i._renderPage(e,s);i.trigger("pageDidAppear",a[n%this.concurrentPages].el.children[1],n),t=a[this.prevPage%this.concurrentPages],t&&i.trigger("pageDidDisappear",t.el.children[1],this.prevPage)},_refresh:function(e){this.pageWidth=this.elements.pages[0].el.clientWidth,this.windowWidth=window.innerWidth,this.gotoCurrentPage()},_onKeyPress:function(e){if(this.options.enableKeyNavigation)switch(e.keyCode){case 37:this.gotoPrevPage();break;case 39:this.gotoNextPage()}},_onMoveStartCapture:function(e){var t=this.elements.pageContainer;this.moved=!1,this.pointX=e.touches[0].pageX,this.pointY=e.touches[0].pageY,this.deltaX=0,this.deltaY=0,this.distX=0,this.distY=0,this.directionCalc=!1,this.multitouch=e.touches.length>1,this.multitouch?(this._disableOverflowScrolling(),t.removeEventListener("touchmove",this._onMoveCapture,!0),t.removeEventListener("touchend",this._onMoveEndCapture,!0)):(t.addEventListener("touchmove",this._onMoveCapture,!0),t.addEventListener("touchend",this._onMoveEndCapture,!0)),t.addEventListener("touchstart",this._onMoveStart,!1)},_onMoveCapture:function(e){var t=this.elements.pageContainer,i=e.touches[0].pageX,n=e.touches[0].pageY;this.multitouch||(this.deltaX=i-this.pointX,this.deltaY=n-this.pointY,this.pointX=i,this.pointY=n,this.directionCalc||(this.distX<4&&this.distY<4&&(this.distX+=Math.abs(this.deltaX),this.distY+=Math.abs(this.deltaY),this.directionCalc=!0),this.distY<2||this.distX>this.distY+5?(this._disableOverflowScrolling(),t.addEventListener("touchmove",this._onMove,!1),t.addEventListener("touchend",this._onMoveEnd,!1)):(this.distX<2||this.distY>this.distX+5)&&this._enableOverflowScrolling()))},_onMoveEndCapture:function(e){if(this.elements.pageContainer.removeEventListener("touchstart",this._onMoveStart,!1),this._disableOverflowScrolling(),this.options.tapToFlip&&!this.moved){if(this.pointX<this.pageFlipWidth)return void this.gotoPrevPage();if(this.pointX>this.windowWidth-this.pageFlipWidth)return void this.gotoNextPage()}},_onMoveStart:function(e){this.startX=e.touches[0].pageX,this.startY=e.touches[0].pageY},_onMove:function(e){e.preventDefault(),clearTimeout(this.renderTimeout),this.moved=!0,(this.x>0||this.currentPage===this.options.numberOfPages-1&&this.x<0)&&(this.deltaX*=.5),this.x+=this.deltaX,this._moveX(this.elements.pageContainer,Math.round(this.x)+"px",0)},_onMoveEnd:function(){var e=this.elements.pageContainer,i=this.startX-this.pointX,n=Math.abs(i),s=Math.abs(this.deltaX),r=this.pageWidth/2,a=this.options.scrollDuration;this.elements.pageContainer.style.webkitTransitionDuration=a+"ms",this.elements.pageContainer.style.MozTransitionDuration=a+"ms",e.removeEventListener("touchmove",this._onMove,!1),e.removeEventListener("touchend",this._onMoveEnd,!1),this._disableOverflowScrolling(),r>n&&t>s?this.gotoCurrentPage():i>0?this.gotoNextPage():this.gotoPrevPage()},_moveX:function(e,t,i){void 0!==i&&(e.style.webkitTransitionDuration=i+"ms",e.style.MozTransitionDuration=i+"ms"),e.style.webkitTransform="translate3d("+t+", 0, 0)",e.style.MozTransform="translate("+t+", 0)"},_onPageChange:function(e){e?this._renderPages():this.renderTimeout=setTimeout(this._renderPages,this.options.renderDeferTime)},_onTransitionEnd:function(e){-1!==e.propertyName.indexOf("transform")&&this._onPageChange()},_preventDefaultEvent:function(e){e.preventDefault()},_disableOverflowScrolling:function(){if(this.options.overflowScrolling){var e=this;s(this.elements.scrollablePages,function(t){t.addEventListener("touchmove",e._preventDefaultEvent,!0)})}},_enableOverflowScrolling:function(){if(this.options.overflowScrolling){var e=this;s(this.elements.scrollablePages,function(t){t.removeEventListener("touchmove",e._preventDefaultEvent,!0)})}}},r.prototype.destroy=r.prototype.disable,exports["default"]=r,Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),i=this,n=function(){},s=function(){return i.apply(this instanceof n?this:e||window,t.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,s.prototype=new n,s})},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(1),s=i(n),r=t(12),a=i(r);t(2),exports["default"]={isInline:!1,defaultMetrics:function(e){this.metrics=s["default"].extend({height:0,width:0,outerHeight:0,lineHeight:24,marginTop:0,marginRight:0,marginBottom:0,marginLeft:0,marginHeight:0,marginWidth:0},this.metrics||{},e||{})},setMetrics:function(e){this.metrics=s["default"].extend(this.metrics||{},e)},calculateMetrics:function(){if(!this.el.children.length)return void(this.metrics=this.$el.metrics());var e=parseInt(window.getComputedStyle(this.el).getPropertyValue("border-bottom-width"),10);return e?void(this.metrics=this.$el.metrics()):(this.isInline||(this.el.style.borderBottom="1px solid transparent"),this.metrics=this.$el.metrics(),void(this.isInline||(this.el.style.removeProperty("border-bottom"),this.metrics.outerHeight-=1)))},lockSize:function(){var e=this.metrics;this.$el.css({height:e.height+"px",width:e.width+"px"})},isTextElement:function(){return-1!==["P","H1","H2","H3","H4","H5","H6","HEADER","SPAN"].indexOf(this.el.tagName)},normalize:function(e,t){if(!this._isNormalized){var i={},n=this.$el.hasClass(a["default"].CONTAINER),r=this.metrics,o=0;this._normalizeTopMargin(i),t=t||0;var l=Math.min(t,r.marginTop);e=e||r.lineHeight,o=(r.outerHeight-l)%e,0===o||n||(o=e-o,r.marginBottom+=o,r.marginHeight+=o,r.outerHeight+=o,i["margin-bottom"]=r.marginBottom+"px"),this._isNormalized=!0,s["default"].isEmpty(i)||this.$el.css(i)}},_normalizeTopMargin:function(e){var t=this.metrics;t.marginTop>0&&this.isTextElement()&&(t.outerHeight-=t.marginTop,t.marginHeight-=t.marginTop,t.marginTop=0,e["margin-top"]=0)}}},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(1),s=i(n),r=t(2),a=i(r),o=t(10),l=i(o),u=t(35),d=i(u),h=t(12),f=i(h),c=l["default"].extend({initialize:function(e){this.article=e,this.compiled={}},compile:function(){var e,t=this.article.content.toJSON();return t.meta.articleId=t.meta.articleId||t.meta.id,delete t.meta.id,e=s["default"].map((0,a["default"])("."+f["default"].ASSET_STYLESHEET),function(e){return e.href}),t.compiled={},t.compiled.pages=s["default"].map(this.article.pages,function(e){return e.compile()}),t.compiled.assets={stylesheets:e,revision:this.article.options.revision},t},decompile:function(e){var t=s["default"].isObject(e)?e:JSON.parse(e),i=t.compiled.assets.revision;i&&(this.article.options.revision=i),this.article.pages=s["default"].map(t.compiled.pages,function(e){var n=new d["default"]({revision:i,assetsBaseUrl:t.service.assetsBaseUrl});return n.decompile(e),n})}});exports["default"]=c},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(2),s=i(n),r=t(1),a=i(r),o=t(11),l=i(o),u=t(36),d=i(u),h=t(38),f=i(h),c=t(39),p=i(c),g=t(51),m=i(g),v=t(33),_=i(v),E=t(28),w=i(E),y=t(12),T=i(y),b=t(25),M=i(b),C=l["default"].extend();a["default"].extend(C.prototype,_["default"],w["default"],{className:"page",initialize:function(e){e=this.options=a["default"].extend({revision:"no-rev"},e||{}),a["default"].bindAll(this,"render"),this.decompiled=!1,this.pageNum="number"==typeof e.pageNum?e.pageNum:null,this.className=e.className||"",this.content=e.content||null,this.layer=e.layer||null,this.fullscreenLayer=e.fullscreenLayer||this.layer&&this.layer.above()||null,this.templateManager=e.templateManager||m["default"],this.format=e.format||null,e.pixelRatio=parseInt(e.pixelRatio||window.devicePixelRatio||1,10),this.defaultMetrics(e.metrics),this.setupWidgets(e)},tearDown:function(){this.el=null,this.pageTemplate&&this.pageTemplate.tearDown(),this.pageTemplate=null,this.content=null,this.fullscreenLayer&&this.fullscreenLayer.hide()},revert:function(){this.rendered=!1,this.pageTemplate.revert()},restoreFromHtml:function(e){this.setElement((0,s["default"])(e)),this.setPageTemplate(new p["default"]({el:this.el.children[0]})),this.rendered=!0},getBestTemplate:function(){var e;return e=this.templateManager.getBestTemplateForPage(this,this.templates),e.template?e:(M["default"].console.warn("No template found for page "+this.pageNum+"! Remaining elements: "+this.content.elementsLeft),!1)},setupBestTemplate:function(){var e=this.getBestTemplate();return e?(this.setTemplate(e.template,e.containerMap,e.score),!0):!1},setTemplate:function(e,t){return this.rendered=!1,this.score=t||0,this.template===e?(this.pageTemplate.reload(),this):(this.template=e,this.setPageTemplate(this.templateManager.getPageTemplateFromTemplate(e,{page:this})),this)},setTemplateIfUsable:function(e){var t,i=e.getContainerMap(this.content);return t=!e.containers||!e.containers.length,(t=t||a["default"].all(i.positions,function(e){return e.isOptional||e.match}))?(this.setTemplate(e,i),!0):(M["default"].console.warn("Page ",this.pageNum,": Template ",e.name,"is no longer usable"),!1)},setPageTemplate:function(e){this.pageTemplate=e,this.$el.empty(),this.$el.append(this.pageTemplate.el),this.containers=this.pageTemplate.containers,this.regions=this.pageTemplate.regions},prepareToRender:function(){var e=[];return this.rendered||!this.template?this:(this.className&&e.push(this.className),e.push(T["default"].REVISION(this.options.revision)),e.push(T["default"].PAGENUM_X(this.pageNum+1)),this.$el.addClass(e.join(" ")),void this.pageTemplate.prepareToRender())},render:function(e){return!this.rendered&&this.decompiled?this._renderCompiled(e):this._pendingReflow?(this._pendingReflow=!1,this.reflow(),this):this.template?this.rendered?(this.pageTemplate.loadContainers(),this):(this._setupMetrics(),this.pageTemplate.render(),this.rendered=!0,e&&this._appendToEl(e),this):this},allPagesDidRender:function(e){var t,i=T["default"].PAGENUM_X("last"),n=T["default"].PAGENUM_TOTAL_X(""),s=[T["default"].PAGENUM_TOTAL_X(e)];t=new RegExp(" ?("+i+"|"+n+"[\\d]*)","g"),e===this.pageNum+1&&s.push(i),this.el.className=this.el.className.replace(t,""),this.$el.addClass(s.join(" "))},play:function(){this.$el.addClass(T["default"].IS_PLAYING)},stop:function(){this.$el.removeClass(T["default"].IS_PLAYING)},prepareToReflow:function(){this.pageTemplate.prepareToReflow()},reflow:function(){return this.isInDOM()?void this.pageTemplate.reflow():void(this._pendingReflow=!0)},lockSize:function(){this.pageTemplate.isResponsive||this.$el.css({width:this.metrics.width+"px",height:this.metrics.height+"px",overflow:"hidden",position:"relative"})},compile:function(){var e=new f["default"](this);return e.compile()},decompile:function(e,t){var i=new f["default"](this);return i.decompile(e,t),this},_renderCompiled:function(e){return e&&this._appendToEl(e),this._setupMetrics(),this.pageTemplate.decompile(),this.rendered=!0,this},_appendToEl:function(e){var t=this.el;setTimeout(function(){(0,s["default"])(e).empty().append(t)},0)},_setupMetrics:function(){var e=this.$el.metrics();this.format&&this.format instanceof d["default"]&&(e.height=this.format.get("height"),e.width=this.format.get("width")),!e.height&&this.metrics.height&&(e.height=this.metrics.height,e.outerHeight=this.metrics.outerHeight),this.metrics=e,this.pageTemplate.metrics=e,e.contentHeight=e.height-e.marginHeight-e.paddingTop-e.paddingBottom,e.contentWidth=e.width-e.marginWidth-e.paddingRight-e.paddingLeft}}),exports["default"]=C},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(37),s=i(n),r=s["default"].extend({defaults:{title:"",name:"",width:0,height:0},initializeFromWindow:function(){return this.set({width:window.innerWidth,height:window.innerHeight,name:"window",title:"Window"}),this}});exports["default"]=r},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(9),s=i(n);exports["default"]=s["default"].Model.extend({})},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(1),s=i(n),r=t(2),a=i(r),o=t(10),l=i(o),u=t(39),d=i(u),h=t(12),f=i(h),c=t(50),p=i(c),g=t(40),m=i(g),v={classNames:[f["default"].IS_DRAGGABLE,f["default"].IS_DRAGGABLE_X,f["default"].IS_DRAGGABLE_Y,f["default"].IS_EDITABLE,f["default"].IS_OPTIONAL,f["default"].IS_REMOVABLE,f["default"].IS_RESIZABLE,f["default"].MULTI_CHOICE],attributes:["data-filter-format-name","data-filter-page-pos","data-map","data-media","data-name","data-score"],elements:["."+f["default"].SIZE_DETECTOR]},_=l["default"].extend({initialize:function(e){s["default"].bindAll(this,"_doDecompile"),this.page=e,this.compiled={v:1,elements:{},assets:{images:[]}}},compile:function(){return this.page.lockSize(),this.compiled.html=this._getCompiledHtml(),this._compileImages(),this._compileStylesheets(),this.compiled.assets.revision=this.page.options.revision,this.compiled},decompile:function(e,t){var i;t=t||function(){},this.page.decompiled=!0,this.compiledObject=s["default"].isObject(e)?e:JSON.parse(e),this.compiledObject.assets.revision&&(this.page.options.revision=this.compiledObject.assets.revision),i=(0,a["default"])(this.compiledObject.html).get(0),this.page.pageTemplate=new d["default"]({el:i.children[0],page:this.page}),this.page.setElement(i),this.promises=this.loadStylesheets(this.compiledObject.assets.stylesheets),m["default"].all(this.promises).then(this._doDecompile).then(t)},strip:function(e){var t,i=(0,a["default"])(e);t="."+v.classNames.join(", ."),i.find("."+f["default"].IS_DISABLED+", ."+f["default"].IS_REMOVED).remove(),i.find(t).removeClass(v.classNames.join(" ")),s["default"].each(v.attributes,function(e){i.find("["+e+"]").removeAttr(e)}),s["default"].each(v.elements,function(e){i.find(e).remove()})},_doDecompile:function(){this.page.containers=this.page.pageTemplate.containers,this.page.regions=this.page.pageTemplate.regions,s["default"].each(this.page.pageTemplate._getAllContainers(),function(e){this.page.layer&&e.setLayer(this.page.layer),this._decompileContainer(e,this.compiledObject.elements[e.id])},this)},_decompileContainer:function(e,t){new p["default"](e).decompile(t)},_getCompiledHtml:function(){var e,t,i,n;return e=(0,a["default"])(this.page.el.outerHTML),t=this.compiled,i=this.page.pageTemplate._getAllContainers(),s["default"].each(i,function(i){var r=new p["default"](i).compile();i.isDisabled||i.isRemoved||(t.elements[i.id]=r,i.fullscreenEl&&(n=(0,a["default"])(i.fullscreenEl).find("img[data-src]"),n.length>0&&(t.assets.images=t.assets.images.concat(s["default"].toArray(n)))),e.find("#"+i.id).replaceWith(r.html),delete r.html)}),this.strip(e),e[0].outerHTML},_compileImages:function(){var e,t=this.compiled;e=this.page.$("img[data-src]"),e.length>0&&(t.assets.images=t.assets.images.concat(s["default"].toArray(e))),t.assets.images=s["default"].map(t.assets.images,this._compileImageAsset,this)},_compileImageAsset:function(e){var t=(0,a["default"])(e),i={},n=t.attr("data-src-2x");return i["1x"]=t.attr("data-src"),n&&(i["2x"]=n),{height:parseInt(t.attr("height"),10),width:parseInt(t.attr("width"),10),urls:i}},_compileStylesheets:function(){this.compiled.assets.stylesheets=s["default"].map((0,a["default"])("."+f["default"].ASSET_STYLESHEET),function(e){return e.href})},loadStylesheets:function(e){e=s["default"].map(e,function(e){return-1===e.indexOf("://")?this.page.options.assetsBaseUrl+e:e},this);var t,i=s["default"].filter((0,a["default"])("."+f["default"].ASSET_STYLESHEET),function(e){return this.page.options.revision===e.getAttribute("data-revision")},this),n=[];return s["default"].each(i,function(i){var n=(0,a["default"])(i),s=e.indexOf(n.attr("href"));return-1!==s?void e.splice(s,1):void(e.length?(t=e.shift(),n.attr("href",t),this._trackStylesheetProgress(t)):n.remove())},this),s["default"].each(e,function(e){var t=(0,a["default"])('<link rel="stylesheet" type="text/css">');t.attr({"class":f["default"].ASSET_STYLESHEET,"data-revision":this.page.options.revision}),(0,a["default"])("head").append(t.attr("href",e)),n.push(this._trackStylesheetProgress(e))},this),n},_trackStylesheetProgress:function(e){var t,i;return t=m["default"].defer(),i=document.createElement("img"),this.page.pageTemplate.addDeferred(t),i.onerror=function(){t.resolve()},i.src=e,t}});exports["default"]=_},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(2),s=i(n),r=t(1),a=i(r),o=t(40),l=i(o),u=t(11),d=i(u),h=t(33),f=i(h),c=t(41),p=i(c),g=t(43),m=i(g),v=t(47),_=i(v),E=t(48),w=i(E),y=t(12),T=i(y),b=t(8),M=i(b);t(49);var C=d["default"].extend();a["default"].extend(C.prototype,f["default"],{initialize:function(e){this.options=e,e.page&&this.setPage(e.page),this.template=e.template||null,this.deferreds=[],this.fullscreenContainer=this._getFullscreenContainer()},tearDown:function(){this.stopListening(),a["default"].invoke(this.containers,"tearDown"),a["default"].invoke(this.regions,"tearDown"),this.template=null,this.containers=null,this.regions=null,this.fullscreenContainer&&this.fullscreenContainer.tearDown()},setElement:function(e){C.__super__.setElement.call(this,e),this.isPositionedGrid=!!this.el.className.match(/cols\-([0-9])+/),this.isResponsive=this.$el.hasClass(T["default"].IS_RESPONSIVE),this.reload()},setPage:function(e){this.page=e,this.content=e.content},prepareToRender:function(){this._setupContainers(),this._renderContainers()},render:function(){return this.loadContainers(),this._fit(),this._fillRegions(),this.trackProgress(),this},reload:function(){this._findContainers(),this._findRegions()},prepareToReflow:function(){a["default"].invoke(this.regions,"tearDown"),this._findRegions()},reflow:function(){this._fit(),this._fillRegions()},revert:function(){this._sizeListener=!1,this.stopListening(),a["default"].invoke(this.regions,"revert"),a["default"].invoke(this.containers,"revert")},decompile:function(){this.decompiled=!0,this.loadContainers(!0,this._getAllContainers()),this.trackProgress()},addDeferred:function(e){this.deferreds.push(e)},didRetainElements:function(){return a["default"].some(this.containers.concat(this.regions),function(e){return e.didRetainElements()})},loadContainers:function(e,t){var i=this.deferreds;return this._setupSizeDetector(),t=t||this.containers,a["default"].each(t,function(t){this._prepareContainerForLoad(t,e),t.load(),i=i.concat(t.deferreds)},this),this.deferreds=i,this},trackProgress:function(){var e=this.page,t=function(){e.trigger("loadComplete",e),M["default"].trigger("loadComplete",e)};this.deferreds.length?l["default"].all(this.deferreds,t):t()},_findContainers:function(){var e=this,t=this.containers;this.containers=a["default"].map(this.$el.find("."+T["default"].CONTAINER),function(i){var n;return n=a["default"].find(t,function(e){return e.el===i}),n||(n=new m["default"]({el:i}),n.isResponsive=e.isResponsive),n})},_findRegions:function(){var e=this.regions,t=this.isPositionedGrid;this.regions=a["default"].map(this.$el.find("."+T["default"].REGION),function(i){return a["default"].find(e,function(e){return e.el===i})||new p["default"]({el:i,isPositionedGrid:t||(0,s["default"])(i).closest(".alf-grid",this.$el).length>=1})},this)},_getAllContainers:function(){var e=a["default"].flatten(a["default"].pluck(this.regions,"containers"));return e.concat(this.containers)},_setupSizeDetector:function(){return this.sizeDetector?void this.sizeDetector.start():void(this.sizeDetector=new w["default"]({target:this.el,watch:this.isResponsive}).render())},_setupContainers:function(){function e(e,t){if(!(e.isRemoved||e.isDisabled||e.rendered)){var i=a["default"].filter(n,function(i){return t.call(this,e,i)});if(!i.length)return void(e.isOptional&&e.disable());e.content=this.content,e.matchingFigureElements=a["default"].flatten(a["default"].pluck(i,"mappedElements")),e.useBestMatchingFigureEl(),e.ref&&(e.figure.ref=e.ref)}}function t(e,t){if(t.retained)return!1;var i=t.getElementsMappedToField(e.fieldMap);return i.length?(t.mappedElements=i,t):!1}function i(e,t){return e.ref&&e.ref===t.ref?t:!1}var n=this.page.content.getFigures();a["default"].each(this.containers,function(i){i.fieldMap.length&&e.call(this,i,t)},this),a["default"].each(this.containers,function(t){t.fieldMap.length||e.call(this,t,i)},this)},_getFullscreenContainer:function(){var e=this.$el.find("."+T["default"].CONTAINER_FULLSCREEN)[0];return e?new _["default"]({el:e.cloneNode(!0),page:this,layer:this.page?this.page.fullscreenLayer:!1,revision:this.page&&this.page.options.revision}):!1},_fit:function(){var e=this.page.metrics,t={lineHeight:e.lineHeight,prefix:"alf-"},i=this.$el.find(".alf-grid");this.isPositionedGrid&&this.$el.grid(t),a["default"].each(i,function(e){(0,s["default"])(e).grid(t)}),a["default"].each(this.regions,function(t){t.metrics=t.$el.metrics(),t.metrics.contentHeight=0,t.metrics.lineHeight=e.lineHeight},this)},_renderContainers:function(){return a["default"].invoke(this.containers,"render"),this},_prepareContainerForLoad:function(e,t){var i,n;i=this.page.widgets,n=this.fullscreenContainer,e.page=this.page,e.setLayer(this.page.layer),e.matchingWidgets=i.getMatchesForContainer(e),e.options.pixelRatio=this.page.options.pixelRatio,e.renderWidgets(),e.unload(),t||(e.metrics=e.$el.metrics(),this.isResponsive||e.normalize()),n&&n.subscribeToContainer(e)},_fillRegions:function(){for(var e=this.page.content,t=[],i=0,n=this.regions[i];n&&(n.setContent(e),n.containers.length&&(t=t.concat(n.containers)),e.hasBlocksLeft());)n=this.regions[++i]||!1;this.loadContainers(!0,t)}}),exports["default"]=C},function(e,exports){/** @license MIT License (c) copyright B Cavalier & J Hann */
"use strict";function t(e,t,n,s){return i(e).then(t,n,s)}function i(e){var t,i;return e instanceof s?t=e:l(e)?(i=o(),e.then(function(e){i.resolve(e)},function(e){i.reject(e)},function(e){i.progress(e)}),t=i.promise):t=r(e),t}function n(e){return t(e,a)}function s(e){this.then=e}function r(e){var t=new s(function(t){try{return i(t?t(e):e)}catch(n){return a(n)}});return t}function a(e){var t=new s(function(t,n){try{return n?i(n(e)):a(e)}catch(s){return a(s)}});return t}function o(){function e(e,t,i){return f(e,t,i)}function t(e){return p(e)}function n(e){return p(a(e))}function r(e){return c(e)}var l,u,d,h,f,c,p;return u=new s(e),l={then:e,resolve:t,reject:n,progress:r,promise:u,resolver:{resolve:t,reject:n,progress:r}},d=[],h=[],f=function(e,t,i){var n,s;return n=o(),s="function"==typeof i?function(e){try{n.progress(i(e))}catch(t){n.progress(t)}}:function(e){n.progress(e)},d.push(function(i){i.then(e,t).then(n.resolve,n.reject,s)}),h.push(s),n.promise},c=function(e){return m(h,e),e},p=function(e){return e=i(e),f=e.then,p=i,c=_,m(d,e),h=d=T,e},l}function l(e){return e&&"function"==typeof e.then}function u(e,i,n,s,r){return v(2,arguments),t(e,function(e){function a(e){g(e)}function l(e){p(e)}var u,d,h,f,c,p,g,m,v,E;if(v=e.length>>>0,u=Math.max(0,Math.min(i,v)),h=[],d=v-u+1,f=[],c=o(),u)for(m=c.progress,g=function(e){f.push(e),--d||(p=g=_,c.reject(f))},p=function(e){h.push(e),--u||(p=g=_,c.resolve(h))},E=0;v>E;++E)E in e&&t(e[E],l,a,m);else c.resolve(h);return c.then(n,s,r)})}function d(e,t,i,n){function s(e){return t?t(e[0]):e[0]}return u(e,1,s,i,n)}function h(e,t,i,n){return v(1,arguments),c(e,E).then(t,i,n)}function f(){return c(arguments,E)}function c(e,i){return t(e,function(e){var n,s,r,a,l,u;if(r=s=e.length>>>0,n=[],u=o(),r)for(a=function(e,s){t(e,i).then(function(e){n[s]=e,--r||u.resolve(n)},u.reject)},l=0;s>l;l++)l in e?a(e[l],l):--r;else u.resolve(n);return u.promise})}function p(e,i){var n=y.call(arguments,1);return t(e,function(e){var s;return s=e.length,n[0]=function(e,n,r){return t(e,function(e){return t(n,function(t){return i(e,t,r,s)})})},w.apply(e,n)})}function g(e,i,n){var s=arguments.length>2;return t(e,function(e){return e=s?n:e,i.resolve(e),e},function(e){return i.reject(e),a(e)},i.progress)}function m(e,t){for(var i,n=0;i=e[n++];)i(t)}function v(e,t){for(var i,n=t.length;n>e;)if(i=t[--n],null!=i&&"function"!=typeof i)throw new Error("arg "+n+" must be a function")}function _(){}function E(e){return e}Object.defineProperty(exports,"__esModule",{value:!0});var w,y,T;t.defer=o,t.resolve=i,t.reject=n,t.join=f,t.all=h,t.map=c,t.reduce=p,t.any=d,t.some=u,t.chain=g,t.isPromise=l,s.prototype={always:function(e,t){return this.then(e,e,t)},otherwise:function(e){return this.then(T,e)},"yield":function(e){return this.then(function(){return e})},spread:function(e){return this.then(function(t){return h(t,function(t){return e.apply(T,t)})})}},y=[].slice,w=[].reduce||function(e){var t,i,n,s,r;if(r=0,t=Object(this),s=t.length>>>0,i=arguments,i.length<=1)for(;;){if(r in t){n=t[r++];break}if(++r>=s)throw new TypeError}else n=i[1];for(;s>r;++r)r in t&&(n=e(n,t[r],r,t));return n},exports["default"]=t},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(1),s=i(n),r=t(11),a=i(r),o=t(33),l=i(o),u=t(42),d=i(u),h=t(43),f=i(h),c=t(44),p=i(c),g=t(46),m=i(g),v=t(25),_=i(v),E=t(12),w=i(E),y=a["default"].extend();s["default"].extend(y.prototype,l["default"],d["default"],{className:w["default"].REGION,initialize:function(e){this.options=e||{},this.defaultMetrics(this.options.metrics),this.metrics.contentHeight=0,this.fragment=null,this._contentContainers=[],this.options.elements&&this.addElements(this.options.elements)},tearDown:function(){this.stopListening(),this.fragment=null,this.revert(),this.el=null,this.$el=null},clone:function(){var e=new y({el:this.el.cloneNode(!0)});return e.content=this.content,e},setElement:function(e){y.__super__.setElement.call(this,e),this._originalHtml=this.$el.html(),this.isFlexible=this.$el.hasClass(w["default"].REGION_FLEXIBLE),this._originalContainers=this._getInlineContainers(),this.containers=this._originalContainers.slice(0)},setContent:function(e){this.content=e,this.addElements(e.getElements())},addElements:function(e){return this.$el.empty(),this.fragment=document.createDocumentFragment(),s["default"].forEach(e,this._addElement,this),this.el.appendChild(this.fragment),this.containers=this._contentContainers,this._contentContainers=[],this},getOverflow:function(e){e=e||{};var t=e.outerHeight||0,i=0;return this.lastUsedElement&&(i=Math.min(this.lastUsedElement.metrics.marginBottom,e.marginTop)),this.metrics.contentHeight-this.metrics.height+t-i},hasSpaceLeft:function(){return this.getOverflow()<0},revert:function(e){s["default"].invoke(this.elements,"revert"),e=e?e:this._originalHtml||"",this.metrics.contentHeight=0,this.lastUsedElement=null,this.releaseAll(),this.el.innerHTML=e,this._originalHtml=e},_addElement:function(e){var t;return e=this._verifyElementIsUsable(e),!e||!this.isFlexible&&0===this.metrics.height?!0:0!==this.metrics.contentHeight&&e.el&&e.$el.hasClass(w["default"].BREAK_BEFORE)?!1:(this._verifyElementMetrics(e),t=this.getOverflow(e.metrics),this.isFlexible||-1*t>=this.metrics.lineHeight?(this._useElement(e),!0):t>-this.metrics.lineHeight&&t<=e.metrics.marginBottom?(e.shouldStickToNext()||this._useElement(e),!1):this._overflowElementIfSupported(e))},_useElement:function(e){var t=0;this.lastUsedElement&&(t=Math.min(this.lastUsedElement.metrics.marginBottom,e.metrics.marginTop));var i=e.metrics.outerHeight-t;this.metrics.contentHeight+=i,this.fragment.appendChild(e.render().el),this.retain(e.figure||e),this.lastUsedElement=e,e instanceof f["default"]&&this._contentContainers.push(e)},_overflowElementIfSupported:function(e){var t,i,n=e.isRearrangeable();return n||e.isSplittable()?n?(this.anchoredBlock=e,!0):(t=this.metrics.height-this.metrics.contentHeight,this._useElement(e),i=e.getOverflowBlock(t).render(),this.content.addAfter(i,this.anchoredBlock||this.lastUsedElement),this.anchoredBlock=null,!1):!1},_verifyElementIsUsable:function(e){if(e instanceof m["default"])return e;if(e instanceof p["default"]&&!this._originalContainers)return!1;var t,i;return s["default"].each(this._originalContainers,function(n){return t=e.getElementMappedToField(n.fieldMap),t?(i=n,!1):void 0}),t?(i=i.clone(),i.isInline=!0,i.content=this.content,i.setFigure(e,t),this.$el.append(i.render().el),i.calculateMetrics(),i.metrics.lineHeight=this.metrics.lineHeight,this.options.isPositionedGrid&&i.normalize(this.metrics.lineHeight,this.lastUsedElement&&this.lastUsedElement.metrics.marginBottom),i.releaseAll(),i.$el.remove(),i):!1},_verifyElementMetrics:function(e){e.metrics.lineHeight!==this.metrics.lineHeight&&_["default"].console.warn("lineHeight mismatch between page and content.","lineHeight on ",this.el,": ",this.metrics.lineHeight,"lineHeight on ",e.el,": ",e.metrics.lineHeight,"The page might not look good!"),this.options.isPositionedGrid&&e.normalize(this.metrics.lineHeight,this.lastUsedElement&&this.lastUsedElement.metrics.marginBottom)},_getInlineContainers:function(){return s["default"].map(this.$el.find("."+w["default"].CONTAINER_INLINE),function(e){return new f["default"]({el:e})})}}),exports["default"]=y},function(e,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]={retain:function(e){this.content.retain(e),this.retained=this.retained||[],this.retained.push(e)},releaseAll:function(){this.retained&&this.retained.length&&(this.content.release(this.retained),this.retained=[])},didRetainElements:function(){return!!this.retained&&this.retained.length>0}}},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(1),s=i(n),r=t(2),a=i(r),o=t(11),l=i(o),u=t(14),d=i(u),h=t(33),f=i(h),c=t(42),p=i(c),g=t(12),m=i(g),v=t(8),_=i(v),E=t(25),w=i(E),y=t(40),T=i(y),b=l["default"].extend();b.loadedAssets=[],s["default"].extend(b.prototype,f["default"],p["default"],{fullscreenEvents:{touch:{"touchstart img, .alf-image":"onTouchStart","touchmove img, .alf-image":"onTouchMove","touchend img, .alf-image":"onTouchEnd","tap img, .alf-image":"onTap"},pointer:{"click img, .alf-image":"onClick","mousedown img, .alf-image":"onMouseDown"}},className:m["default"].CONTAINER,initialize:function(e){e=this.options=s["default"].extend({},e||{}),s["default"].bindAll(this,"load","_doLoad","_loadComplete","_loadReady","enterFullscreen"),this.defaultMetrics(),this.deferreds=[],this.loaded=null,this.isDirty=!1,this.isResponsive=!1,this.mouseDownX=0,this.mouseDownY=0,this.mouseDownTime=0,this.matchingFigureElements=[],this._lastState={},e.pixelRatio=parseInt(e.pixelRatio||window.devicePixelRatio||1,10)},tearDown:function(){this.releaseAll(),this.stopListening(),this.undelegateEvents(),this.el=null,this.figureEl=null,this.fullscreenEl&&(0,a["default"])(this.fullscreenEl).remove(),this.fullscreenEl=null,this.$el.find("img").each(function(){this.style.removeProperty("max-width"),this.style.removeProperty("max-height"),this.style.removeProperty("width"),this.style.removeProperty("height")})},remove:function(){this.$el.addClass(m["default"].IS_REMOVED),this.isRemoved=!0,this.releaseAll(),this.figure=null,this.figureEl=null,this.$el.empty()},clone:function(){var e;return e=new b({el:this.el.cloneNode(!0)}),e._setUniqueId(),e},setElement:function(e){b.__super__.setElement.call(this,e),this.fieldMap=w["default"].dom.getFieldMap(this.el),this.ref=this.el.dataset.ref,this.isOptional=this.$el.hasClass(m["default"].IS_OPTIONAL),this.isRemoved=this.$el.hasClass(m["default"].IS_REMOVED),this.type=this.$el.attr("data-type")},setFigure:function(e,t){return this.figureElSignature&&this.figureElSignature!==t.signature&&this.revert(),this.figure=e,this.figureEl=t,this.figureElSignature=t.signature,this.retain(e),this},setFigureEl:function(e){this.setFigure(e.figure,e)},useBestMatchingFigureEl:function(){var e=this;if(!this.matchingFigureElements.length)return!1;var t=s["default"].find(this.matchingFigureElements,function(t){return t.matchesAnySignature(e.figureElSignature)});return this.setFigureEl(t||this.matchingFigureElements[0]),!0},useNextFigureEl:function(){var e=this.matchingFigureElements.length;if(!e)return!1;var t=this.matchingFigureElements.indexOf(this.figureEl)+1;return this.setFigureEl(this.matchingFigureElements[t%e]),!0},setLayer:function(e){this.layer=e,this.fullscreenLayer||(this.fullscreenLayer=e.above()),this._setupFullscreen()},setFullscreenEl:function(e){this.fullscreenEl=e,this._setupFullscreen()},preventDefaultEvents:function(){this.undelegateEvents(this.fullscreenEvents)},isSplittable:function(){return!1},isRearrangeable:function(){return this.$el.hasClass(m["default"].IS_REARRANGEABLE)?!0:!1},render:function(){return this.isReadyForRender()?(this.id=this.el.id||this._setUniqueId(),this.rendered=!0,this.isUsingSameFigureEl()?(this.$el.append(this._lastState.html),this.renderedWidgets=this._lastState.renderedWidgets||!1):(this.renderProcessedContainerContent(),this.renderBgImages(),this._originalHtml=this.el.outerHTML),this.matchingFigureElements&&this.matchingFigureElements.length>1&&this.$el.addClass(m["default"].MULTI_CHOICE),this):this},isReadyForRender:function(){return this.figureEl&&!this.rendered&&!this.isDisabled&&!this.isRemoved},renderProcessedContainerContent:function(){var e=this.figureEl.el.outerHTML,t=this.el.dataset.select||this.el.dataset.selectInner,i=t?this.$el:(0,a["default"])(this.el).find("[data-select], [data-select-inner]");return 0===i.length?this.$el.append(e):void i.each(function(t,i){var n,s=i.dataset.select,r=!1;s||(s=i.dataset.selectInner,r=!0);try{n=(0,a["default"])(e).find(s)[0]}catch(o){}n?i.innerHTML=r?n.innerHTML:n.outerHTML:i.parentNode.removeChild(i)})},renderBgImages:function(){var e=this;if("image"===this.type){var t=this.$el.find("img");t.length&&t.each(function(t,i){var n=i.getAttribute("data-src")||i.getAttribute("src"),s=i.getAttribute("data-src-2x"),r=parseInt(i.getAttribute("width"),10),o=parseInt(i.getAttribute("height"),10),l=o/r,u={width:"100%","padding-bottom":100*l+"%","background-image":"url("+n+")","background-repeat":"no-repeat","background-size":"cover","background-position":"50% 50%"},d={"data-ratio":l,"data-width":r,"data-height":o,"data-src":i.getAttribute("data-src")};s&&(d["data-src-2x"]=s);var h=(0,a["default"])("<div>").attr(d).addClass(m["default"].IMAGE).css(u);(0,a["default"])(i).replaceWith(h),e._trackAssetProgress(n)})}},discard:function(){this.rendered=!1,this._lastState={},this.$el.empty(),this.render(),this.renderedWidgets=!1,this.renderWidgets(),this.unload(),this.load()},revertToOriginal:function(){this.$el.html(this._originalHtml)},revert:function(){this.rendered&&this.saveState(),this._originalHtml=!1,this.rendered=!1,this.renderedWidgets=!1,this.figure=null,this.figureEl=null,this.fullscreenEl=null,this.fullscreenLoaded=!1,this.releaseAll(),this.$el.empty(),this.enable()},isUsingSameFigureEl:function(){return this.figureEl.matchesAnySignature(this._lastState.figureElSignature)},saveState:function(e){this._lastState=s["default"].extend({html:this.el.innerHTML,figureElSignature:this.figureElSignature,renderedWidgets:this.renderedWidgets},e||{})},load:function(){T["default"].all(this._runWidgets(),this._doLoad)},unload:function(){this.loaded!==!1&&(this.loaded=!1,this.unloadElement(this.el))},unloadElement:function(e){var t=(0,a["default"])(e);t.addClass(m["default"].CONTAINER_IS_UNLOADED),t.find("img[data-src]").each(function(){this.setAttribute("src","data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==")})},addDeferred:function(e){this.deferreds.push(e)},shouldStickToNext:function(){return!1},enterFullscreen:function(e){if(!this._supportsFullscreen)return w["default"].console.warn("This container does not support fullscreen"),this.layer||w["default"].console.warn("  Missing layer"),void(this.fullscreenEl||w["default"].console.warn("  Missing fullscreenEl"));var t=this.transition;return this.gestureStarted||t.isRunning()?!1:(this.layer.transition=t,e&&e instanceof HTMLElement&&t.setTargetEl(e),void t.run())},_setupFullscreen:function(){!this._supportsFullscreen&&this.fullscreenEl&&this.layer&&this.fullscreenLayer&&(this.transition=this.transition||this.layer.transitionTo(this.fullscreenLayer,d["default"].Fade),this.$el.addClass(m["default"].SUPPORTS_FULLSCREEN),this.listenTo(this.transition,{willAppear:this._fullscreenWillAppear,didAppear:this._fullscreenDidAppear,didDisappear:this._fullscreenDidDisappear}),this.layer.transition=this.transition,this.delegateEvents(w["default"].touchScreen?this.fullscreenEvents.touch:this.fullscreenEvents.pointer),this._supportsFullscreen=!0)},_setUniqueId:function(e){return e||(e=s["default"].uniqueId("c")),this.id=e,this.el.id=e,e},renderWidgetMatch:function(e){e.widget.render.call(e,this,e.el),e.widget.compile||(this.isDirty=!0)},renderWidgets:function(){return this.renderedWidgets?!1:(s["default"].each(this.matchingWidgets,function(e){(!this.decompiled||this.decompiled&&!e.widget.compile)&&this.renderWidgetMatch(e)},this),void(this.renderedWidgets=!0))},_runWidgets:function(){var e,t=[];return s["default"].each(this.matchingWidgets,function(i){e=T["default"].defer(),i.widget.compile||(this.isDirty=!0),i.widget.run.call(i,e.resolve),t.push(e)},this),t},_doLoad:function(){var e,t=this,i=Math.min(this.options.pixelRatio,2);return this.loaded?void 0:(this.$el.hasClass(m["default"].ALLOW_OVERFLOW)||this._fitBoundaries(),this.$assets=this.$el.find("img[data-src]"),e="data-src"+(i>1?"-"+i+"x":""),s["default"].each(this.$assets,function(i){var n=i.getAttribute(e)||i.getAttribute("data-src");t._trackAssetProgress(n||i.getAttribute("src"),i),n&&(i.src=n)}),T["default"].any(this.deferreds,this._loadReady),T["default"].all(this.deferreds,this._loadComplete),this.loaded=!0,this)},_fullscreenWillAppear:function(e,t){this.trigger("fullscreenWillAppear",e,t)},_fullscreenDidAppear:function(e){this.trigger("fullscreenDidAppear",e)},_fullscreenDidDisappear:function(e){this.trigger("fullscreenDidDisappear",this),_["default"].trigger("fullscreenDidDisappear",this)},_loadReady:function(){this.$el.removeClass(m["default"].CONTAINER_IS_UNLOADED)},_loadComplete:function(){this.trigger("loadComplete")},_trackAssetProgress:function(e,t){var i=this,n=T["default"].defer();this.addDeferred(n),-1!==b.loadedAssets.indexOf(e)?n.resolve({},t):(t||(t=new Image,t.src=e),t.addEventListener("load",function(t){b.loadedAssets.push(e),n.resolve(t,t.currentTarget)}),t.addEventListener("error",function(t){n.resolve(t,t.currentTarget),_["default"].trigger("assetLoadError",i,e)}))},_fitBoundaries:function(){var e=[],t=this;this.decompiled||this.isResponsive||(this.$el.find("img").each(function(){var i,n=this.clientWidth,s=this.clientHeight;n>t.metrics.width&&(i=t.metrics.width/n,e.push({el:this,css:{height:s*i+"px",width:t.metrics.width+"px"}}))}),s["default"].each(e,function(e){(0,a["default"])(e.el).css(e.css)}))},onTouchStart:function(e){e=e.originalEvent||e;var t=e.touches[0];this._touchStartX=t.pageX,this._touchStartY=t.pageY,this._touchMoveX=t.pageX,this._touchMoveY=t.pageY},onTouchMove:function(e){e=e.originalEvent||e;var t=e.touches[0];this._touchMoveX=t.pageX,this._touchMoveY=t.pageY},onTouchEnd:function(e){var t,i;t=Math.abs(this._touchStartX-this._touchMoveX),i=Math.abs(this._touchStartY-this._touchMoveY),7>t&&7>i&&e.preventDefault()},onMouseDown:function(e){this.mouseDownX=e.pageX,this.mouseDownY=e.pageY,this.mouseDownTime=Date.now()},onTap:function(e){this.enterFullscreen(e.currentTarget)},onClick:function(e){var t=Math.abs(e.pageX-this.mouseDownX),i=Math.abs(e.pageY-this.mouseDownY),n=Date.now()-this.mouseDownTime;t>5||i>5||n>1500||this.enterFullscreen(e.currentTarget)},onGestureStart:function(e){var t=this.transition;return this.gestureStarted||t.isRunning()?!1:(this.gestureStarted=!0,t.setTargetEl(e.currentTarget),void this.startTransform(e))},onGestureChange:function(e){var t=this.transition;return t.isRunning()?!1:void this.transformEventTarget(e)},onGestureEnd:function(e){var t=this.transition;return t.isRunning()?!1:(t.run(),void(this.gestureStarted=!1))}}),exports["default"]=b},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function n(e){return o["default"].map(e,p)}function s(e){if(-1===e.indexOf("*"))return new RegExp("^"+e+"$");var t=e.replace(/([\-\:])/g,"\\$1");return t=t.replace(/(^|[^\\W\*])\*(\\|$)/g,"$1[^\\W]+$2"),t=t.replace(/(^|[^\\W])\*\*(\\|$)/g,"$1(.*)?$2"),new RegExp("^"+t+"$")}function r(e,t){return o["default"].find(t,function(t){return t.match(e)})}Object.defineProperty(exports,"__esModule",{value:!0});var a=t(1),o=i(a),l=t(11),u=i(l),d=t(12),h=i(d),f=t(45),c=i(f),p=o["default"].memoize(s),g=o["default"].memoize(r,function(e,t){return[e,t]}),m=u["default"].extend({initialize:function(){var e=this;this.elements=o["default"].map(this.$el.children("[data-map]"),function(t,i){var n=new c["default"]({el:t,figure:e});return n.lockSignature(),n})},setElement:function(e){m.__super__.setElement.call(this,e),this.isOptional=this.$el.hasClass(h["default"].IS_OPTIONAL)},getElementMappedToField:function(e){var t=!1,i=!1;return o["default"].each(n(e),function(e){return(t=o["default"].find(this.elements,function(t){return g(e,t.fieldMap)}))?t.noScore?(i=i||t,void(t=!1)):!1:void 0},this),t||i},getElementsMappedToField:function(e){var t=this,i=o["default"].map(n(e),function(e){return o["default"].filter(t.elements,function(t){return g(e,t.fieldMap)})}),s=o["default"].flatten(i);return s=s.sort(function(e,t){return e.noScore===t.noScore?0:t.noScore?-1:1})}});exports["default"]=m},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(11),s=i(n),r=t(12),a=i(r),o=t(25),l=i(o),u=s["default"].extend({initialize:function(e){this.figure=e.figure},setElement:function(e){u.__super__.setElement.call(this,e),this.noScore=this.$el.hasClass(a["default"].NO_SCORE),this.fieldMap=l["default"].dom.getFieldMap(this.el)}});exports["default"]=u},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(1),s=i(n),r=t(2),a=i(r),o=t(11),l=i(o),u=t(33),d=i(u),h=t(12),f=i(h),c=l["default"].extend();s["default"].extend(c.prototype,d["default"],{tagName:"p",isInline:!0,initialize:function(e){e=e||{},this.isOverflow=!1,this.isDirty=!1,this.originalMetrics=null,e.metrics||this.defaultMetrics()},render:function(){if(this.isRendered)return this;if(this.isFirst&&this.$el.addClass(f["default"].IS_FIRST_BLOCK),this.isLast&&this.$el.addClass(f["default"].IS_LAST_BLOCK),this.isOverflow){var e=(0,a["default"])('<div style="overflow:hidden;padding:0;"></div>');e.css("margin-bottom",this.metrics.marginBottom+"px").addClass(f["default"].IS_SPLITTABLE).addClass(f["default"].IS_NON_REARRANGEABLE).append(this.el),this.$el.css("margin-bottom","0px"),this.setElement(e[0]),this.isDirty=!0}return this.isRendered=!0,this},clone:function(){var e=new c({el:this.el.cloneNode(!0)});return e.clonedFrom=this,e.metrics=s["default"].extend({},this.metrics),e.isLast=this.isLast,this.isDirty&&e.$el.removeAttr("style"),e},revert:function(){this.isDirty&&(this.isOverflow||this.el.style.removeProperty("overflow"),this.el.style.removeProperty("height"),this.isDirty=!1)},isSplittable:function(){return this.$el.hasClass(f["default"].IS_NON_SPLITTABLE)?!1:this.$el.hasClass(f["default"].IS_SPLITTABLE)||-1!==["P","UL","OL"].indexOf(this.el.tagName)},isRearrangeable:function(){return this.$el.hasClass(f["default"].IS_NON_REARRANGEABLE)?!1:this.$el.hasClass(f["default"].IS_REARRANGEABLE)||-1!==["DIV"].indexOf(this.el.tagName)},shouldStickToNext:function(){return this.$el.hasClass(f["default"].STICK_TO_NEXT)||-1!==["H1","H2","H3"].indexOf(this.el.tagName)},getOverflowBlock:function(e){var t,i,n=0;i=this.clone(),i._isNormalized=!1,i.isOverflow=!0,i.overflowMarginTop=this.isOverflow?this.metrics.overflowMarginTop:0,t=e%this.metrics.lineHeight,n=e-t,this.$el.css({overflow:"hidden",height:n+"px"}),this.isDirty=!0;var s=i.overflowMarginTop;return i.$el.css("margin-top",s-n+"px"),i.metrics.height-=n,i.metrics.outerHeight-=n,i.metrics.overflowMarginTop=s-n,i}}),exports["default"]=c},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(1),s=i(n),r=t(11),a=i(r),o=t(33),l=i(o),u=t(25),d=i(u),h=t(12),f=i(h),c=t(8),p=i(c),g=t(40),m=i(g),v=a["default"].extend();s["default"].extend(v.prototype,l["default"],{initialize:function(e){e=this.options=s["default"].extend({},e||{}),this.layer=this.options.layer||null},tearDown:function(){this.stopListening(),this.$el.remove()},subscribeToContainer:function(e){var t;!e.fullscreenEl&&e.figure&&(t=this.getFullscreenElement(e.figure),t&&e.setFullscreenEl(t)),this.listenTo(e,{fullscreenWillAppear:function(t,i){this._loadMathchingWidgetsForContainer(e,i)}})},getFullscreenElement:function(e){var t=d["default"].dom.getFieldMap(this.el),i=e.getElementMappedToField(t);return i?i.el.cloneNode(!0):null},loadContainer:function(e,t){if(!this.layer)return void d["default"].console.warn("No fullscreen layer found");var i,n=function(){e.fullscreenLoaded=!0,t()};return this.$el.empty().addClass(f["default"].IS_VISIBLE).append(e.fullscreenEl),this.layer.renderFullscreenContainer(this),e.fullscreenLoaded?n():(i=this.layer.$el.find("img[data-src]"),i.length||n(),void i.each(function(){this.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",this.addEventListener("load",n),this.src=this.getAttribute("data-src")}))},exitFullscreen:function(){this.layer.exitFullscreen()},_loadMathchingWidgetsForContainer:function(e,t){var i,n=[];return i=function(){p["default"].trigger("fullscreenWillAppear",e),t()},e.matchingWidgets&&e.matchingWidgets.length?(n.push(m["default"].defer()),this.loadContainer(e,n[0].resolve),s["default"].each(e.matchingWidgets,function(e){var t=m["default"].defer();n.push(t),e.widget.fullscreen.call(e,this,t.resolve)},this),void m["default"].all(n,i)):this.loadContainer(e,i)}}),exports["default"]=v},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(1),s=i(n),r=t(2),a=i(r),o=t(12),l=i(o),u=t(40),d=i(u),h=t(11),f=i(h),c=s["default"].memoize(function(e){if(!e)return{};var t=e.replace(/\s+/g,"").split(";"),i={};return s["default"].each(t,function(e){var t=e.split(":"),n=t[0],s=parseInt(t[1],10);isNaN(s)&&(s="false"!==t[1]),i[n]=s}),i}),p=f["default"].extend();s["default"].extend(p.prototype,{tagName:"object",className:l["default"].SIZE_DETECTOR,initialize:function(e){e=this.options=s["default"].extend({start:300,end:1200,interval:50,refreshRate:50,watch:!0,target:null},e||{}),this.$target=(0,a["default"])(this.options.target),s["default"].extend(this.options,c(this.$target.attr("data-respond"))),s["default"].bindAll(this,"_onResize","_setupListenerForView"),this._onResize=s["default"].throttle(this._onResize,e.refreshRate),this._deferred=d["default"].defer(),this.isReady=this._deferred.promise},start:function(){this._setupListenerForView()},tearDown:function(){var e=this.el.contentDocument;e&&e.defaultView&&e.defaultView.removeEventListener("resize",this._onResize),this.$el.remove()},render:function(){if(!this.options.watch)return this._applyClassNamesForWidth(this.$target.width()),this._deferred.resolve(),this;var e=this.$target.find("."+l["default"].SIZE_DETECTOR);return e.length?(this.setElement(e),this.start(),this):(this.$el.css({display:"block",position:"absolute",top:0,right:0,bottom:0,left:0,width:"100%","pointer-events":"none","z-index":-2147483648}),this.el.type="text/html",this.el.data="about:blank",this.start(),this.$target.append(this.$el),this)},getClassNamesForWidth:function(e){for(var t=this.options,i=t.start,n=t.end,s=t.interval,r=[],a=i;n>=a;a+=s)e>a?r.push("alf-gt"+a):r.push("alf-lt"+a);return r},_onResize:function(e){var t=e.target.innerWidth;this._applyClassNamesForWidth(t)},_setupListenerForViewOnLoad:function(){this.$el.on("load",s["default"].bind(function(){setTimeout(this._setupListenerForView,0),this.$el.off("load")},this))},_setupListenerForView:function(){if(!this.el.contentDocument)return void this._setupListenerForViewOnLoad();var e=this.el.contentDocument.defaultView;e.addEventListener("resize",this._onResize),this._applyClassNamesForWidth(e.innerWidth),this._deferred.resolve()},_applyClassNamesForWidth:function(e){var t=this.getClassNamesForWidth(e);if(this.options.target){var i=(0,a["default"])(this.options.target).get(0),n=i.className;n=a["default"].trim(n.replace(/alf\-(g|l)t(\d+)\s?/g,"")),n+=" "+t.join(" "),i.className=n}this.trigger("resize",e)}}),exports["default"]=p},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(5),s=i(n),r=function(e){var t;this.options=s["default"].extend({prefix:""},e),this.el=e.el,this.height=e.height||(0,s["default"])(this.el).height(),this.lineHeight=e.lineHeight||0,t=window.getComputedStyle(this.el,null),this.paddingTop=parseInt(t.getPropertyValue("padding-top"),10),this.paddingBottom=parseInt(t.getPropertyValue("padding-bottom"),10),this.height-=this.paddingTop+this.paddingBottom,this._position()};r.prototype._position=function(){var e=this,t=[],i=this.el.className.match(/cols\-([0-9]+)/);if(!i)throw new Error("Failed to find number of columns");i=parseInt(i[1],10);for(var n=0;i>n;n++)t[n]={remainingHeight:this.height,cells:[]};(0,s["default"])(this.el).find('[class*="col-"]').each(function(){var i=parseInt(this.className.match(/col\-([0-9]+)/)[1],10)-1,n=this.className.match(/colspan\-([0-9]+)/),r=e._createCellFromEl(this);if(n=n?parseInt(n[1],10):1,"none"!==(0,s["default"])(this).css("display"))for(var a=i;i+n>a;a++)t[a].cells.push(r)}),this._calcMetrics(t),s["default"].each(t,function(t,i){e._positionColumn(t,i)})},r.prototype._createCellFromEl=function(e){var t=(0,s["default"])(e).hasClass(this._class("flex"));return{el:e,flex:t,height:0,innerHeight:0,top:0}},r.prototype._calcMetrics=function(e){var t,i,n,r,a,o,l,u,d,h;for(t=this._class("col-top"),i=this._class("col-bottom"),n=e.length,l=0;n>l;l++)for(r=e[l].cells.length,u=0;r>u;u++)a=e[l].cells[u],o=(0,s["default"])(a.el),o.removeClass(t+" "+i),0===u&&(a.isTop=!0,o.addClass(t)),u===r-1&&(a.isBottom=!0,o.addClass(i));for(l=0;n>l;l++)for(r=e[l].cells.length,u=0;r>u;u++)a=e[l].cells[u],o=(0,s["default"])(a.el),a.height=a.flex?0:o.outerHeight(),a.isTop&&(d=window.getComputedStyle(a.el,null),e[l].marginTop=parseInt(d.getPropertyValue("margin-top"),10),e[l].marginTopOffset=e[l].marginTop%this.lineHeight,a.flex||(a.innerHeight=o.height(),0===a.innerHeight&&(h=parseInt(d.getPropertyValue("margin-bottom"),10),a.height-=h))),e[l].remainingHeight-=a.height},r.prototype._positionColumn=function(e,t){var i=this,n=this.paddingTop;s["default"].each(t.cells,function(e,r){var a=(0,s["default"])(r.el),o={},l=0;if(!i.lineHeight||r.isTop||r.isBottom&&!r.flex||(l=(n-t.marginTopOffset-i.paddingTop)%i.lineHeight,0!==l&&(l=i.lineHeight-l,t.remainingHeight-=l,n+=l)),(!r.isTop||r.top<n)&&(r.top=n),o.top=r.top+"px",r.flex){var u=parseInt(a.css("margin-bottom"),10)+parseInt(a.css("margin-top"),10);r.height=t.remainingHeight,o.height=(r.height>u?r.height-u:0)+"px"}a.css(o),n+=r.height})},r.prototype._class=function(e){return this.options.prefix+e},"undefined"!=typeof window&&(s["default"].fn.grid=function(e){return e=e||{},e.el=this[0],new r(e)}),exports["default"]=r},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(1),s=i(n),r=t(2),a=i(r),o=t(10),l=i(o),u=l["default"].extend({initialize:function(e){this.container=e,this.compiled={}},compile:function(){var e=this.container,t=(0,a["default"])(e.el.outerHTML);return e.isDirty&&e.revertToOriginal(),e.unloadElement(t),this.compiled={loaded:!1,metrics:e.metrics,html:t[0].outerHTML},e.fullscreenEl&&(this.compiled.fullscreenEl=e.fullscreenEl.outerHTML),this.compiled},decompile:function(e){var t=this.container;t.decompiled=!0,s["default"].extend(t,e),t.fullscreenEl&&t.setFullscreenEl((0,a["default"])(t.fullscreenEl).get(0))}});exports["default"]=u},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){return{callback:e,name:t}}Object.defineProperty(exports,"__esModule",{value:!0});var s=t(1),r=i(s),a=t(52),o=i(a),l=t(53),u=i(l),d=t(54),h=i(d),f=t(25),c=i(f),p=t(39),g=i(p),m={filters:{article:r["default"].map(u["default"],n),page:r["default"].map(h["default"],n)},addArticleFilter:function(e,t){this.filters.article.push({callback:e,name:t||"articlefilter"})},addPageFilter:function(e,t){this.filters.page.push({callback:e,name:t||"pagefilter"})},getBestTemplateForPage:function(e,t){var i,n,s={score:-(1/0),template:null,containerMap:null};return r["default"].each(t,function(t){i=t.getContainerMap(e.content),n=t.score(e,i),(n>s.score||n===s.score&&Math.random()>.5)&&(s.score=n,s.template=t,s.containerMap=i)}),s},getEligibleTemplatesForArticle:function(e,t){return this._filterTemplates("article",e,t)},getEligibleTemplatesForPage:function(e,t){return this._filterTemplates("page",e,t)},getScoredTemplatesForPage:function(e,t){return r["default"].map(this.getEligibleTemplatesForPage(e,t),function(t){return{template:t,score:t.score(e)}})},getPageTemplateFromTemplate:function(e,t){return new g["default"](r["default"].extend(t||{},{el:e.el.cloneNode(!0)}))},getTemplateFromPageTemplate:function(e,t){var i=new o["default"](r["default"].extend(t||{},{el:e.el.cloneNode(!0)}));return r["default"].each(i.regions,function(t,i){
t.revert(e.regions[i]._originalHtml)}),r["default"].invoke(i.containers,"revert"),i},_filterTemplates:function(e,t,i){return t.pages?c["default"].console.groupCollapsed("** Filtering templates for article"):c["default"].console.groupCollapsed("** Filtering templates for page",t.pageNum+1),r["default"].each(this.filters[e],function(e){var n=i.slice(0);i=e.callback.call(this,t,i),c["default"].console.groupCollapsed("Filter `"+e.name+"` on",n.length,"templates (removed",n.length-i.length,"templates)"),n.length-i.length&&r["default"].each(n,function(e){-1===i.indexOf(e)&&c["default"].console.debug("-",e.name)}),c["default"].console.groupEnd()},this),c["default"].console.debug("Remaining templates:",i.length),c["default"].console.groupEnd(),i}};exports["default"]=m},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(1),s=i(n),r=t(11),a=i(r),o=t(41),l=i(o),u=t(43),d=i(u),h=t(44),f=i(h),c=t(12),p=i(c),g=-500,m=100,v=0,_=-500,E=100,w=5,y=a["default"].extend();s["default"].extend(y.prototype,{setElement:function(e){y.__super__.setElement.call(this,e),this.name=this.$el.attr("data-name"),this.signature=void 0,this.lockSignature(),this.containers=this.$el.find("."+p["default"].CONTAINER).map(function(){return new d["default"]({el:this})}),this.regions=this.$el.find("."+p["default"].REGION).map(function(){return new l["default"]({el:this})}),this.baseScore=parseInt(this.$el.attr("data-score")||0,10)},score:function T(e,t){var T=this.baseScore,i=e.content.getBlocks();return t=t||this.getContainerMap(e.content),T+=t.score||0,s["default"].each(t.positions,function(e){T+=e.match?e.noScore?0:m:e.isOptional?v:g}),this.regions.length&&(T+=i.length?E:_),this.lastScore=T,T},getContainerMap:function(e){var t,i,n,r=[],a={matches:0,positions:{},score:0,template:this};return t=e.getElements(),i=e.getFigures(),n=t.length,s["default"].each(this.containers,function(e,s){var o,l,u;for(u=a.positions[s]={match:!1,fieldMap:e.fieldMap,isOptional:e.isOptional||!e.fieldMap.length&&e.ref},o=0;n>o;o++)if(t[o]instanceof f["default"]&&-1===r.indexOf(t[o])&&(l=t[o].getElementMappedToField(e.fieldMap)))return a.score-=o*w,a.matches+=1,r.push(t[o]),u.match=!0,u.index=i.indexOf(t[o]),void(u.noScore=l.noScore)}),a}}),exports["default"]=y},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(1),s=i(n),r=t(25),a=i(r),o=!!a["default"].matchMedia;exports["default"]={mediaQuery:function(e,t){return o?s["default"].filter(t,function(e){var t=a["default"].dom.getMediaQuery(e.el);return t?a["default"].matchMedia(t).matches:!0}):t},fieldMap:function(e,t){var i,n=e.content.fieldMap;return n&&n.length?s["default"].filter(t,function(e){return i=a["default"].dom.getFieldMap(e.el),i.length?s["default"].intersection(n,i).length>0:!1}):t},emptyContainers:function(e,t){var i;return i=function(e){return e.match===!0||e.match===!1&&e.isOptional},s["default"].filter(t,function(t){var n=t.getContainerMap(e.content);return s["default"].every(n.positions,i)})},formatName:function(e,t){var i;return e.format&&(i=e.format.get("name"))?s["default"].filter(t,function(e){var t=e.$el.attr("data-filter-format-name");return t?-1!==t.split(" ").indexOf(i):!0}):t}}},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(1),s=i(n);exports["default"]={emptyBlocks:function(e,t){var i=e.content.getBlocks(),n=e.content.getFigures();return i.length?t:s["default"].filter(t,function(e){var t=e.regions;return t.length?s["default"].any(t,function(e){return e.containers.length?s["default"].any(e.containers,function(e){return s["default"].any(n,function(t){return t.getElementMappedToField(e.fieldMap)})}):!1}):e})},emptyContainers:function(e,t){var i;return i=function(e){return e.match===!0||e.match===!1&&e.isOptional},s["default"].filter(t,function(t){var n=t.getContainerMap(e.content);return s["default"].every(n.positions,i)})},pagePosition:function(e,t){return s["default"].filter(t,function(t){var i=t.$el.attr("data-filter-page-pos"),n=e.pageNum+1,r=!1;return i?(i=i.split(" "),s["default"].each(i,function(e){var t=!1,i=parseInt(e,10);return"!"===e[0]&&(t=!0,i=parseInt(e.substr(1),10)),t&&i!==n||!t&&i===n?(r=!0,!1):void 0}),r):!0})}}},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(1),s=i(n),r=t(2),a=i(r),o=t(25),l=i(o),u=t(37),d=i(u),h=t(46),f=i(h),c=t(44),p=i(c),g=d["default"].extend({defaults:{contents:{},meta:{}},initialize:function(e){e&&e.contents&&this._changeContents(),this.on("change:contents",this._changeContents),this.__defineGetter__("elementsLeft",this._getElementsLeft)},setElements:function(e){e=s["default"].filter(e,function(e){return"P"===e.tagName&&e.innerHTML.length<15&&!e.innerHTML.replace(/(\s+)?(<br(\s+)?\/?>)?(&nbsp;)?/gim,"")?!1:e}),this.elements=s["default"].map(e,function(e){var t={el:e};if("FIGURE"===e.tagName){var i=new p["default"](t);if(i.elements.length)return i}return new f["default"](t)});var t=this.getBlocks();t.length&&(t[0].isFirst=!0,t[t.length-1].isLast=!0)},addAfter:function(e,t){var i=this.elements;i.splice(i.indexOf(t)+1,0,e)},each:function(e,t){s["default"].each(this.elements,e,t||this)},release:function(e){e=s["default"].isArray(e)?e:[e],s["default"].each(e,function(e,t){e.retained=!1,e.clonedFrom&&!e.clonedFrom.retained?this.elements.splice(this.elements.indexOf(e),1):e.revert&&e.revert()},this)},releaseAll:function(){this.release(this.elements)},retain:function(e){var t=s["default"].isArray(e)?e:[e];s["default"].each(t,function(e){e.retained=!0})},retainAll:function(){s["default"].each(this.elements,function(e){e.retained=!0})},getElements:function(){return s["default"].filter(this.elements,function(e){return!e.retained})},getBlocks:function(){return s["default"].filter(this.elements,function(e){return!e.retained&&e instanceof f["default"]})},getFigures:function(){return s["default"].filter(this.elements,function(e,t){return!e.retained&&e instanceof p["default"]})},hasBlocksLeft:function(){return this.getBlocks().length>0},isEmpty:function(){return 0===this.elementsLeft},_changeContents:function(){var e,t;e=(0,a["default"])(this.get("contents").source),t=e.children(),this.className=e.attr("class"),this.fieldMap=l["default"].dom.getFieldMap(e[0]),this.setElements(t)},_getElementsLeft:function(){return s["default"].reduce(this.elements,function(e,t){return t.retained?e:e+1},0)}});exports["default"]=g},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(57),s=i(n);exports["default"]={Article:s["default"]}},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(1),s=i(n),r=t(10),a=i(r),o=t(58),l=i(o),u=a["default"].extend({initialize:function(e){this.article=e},serialize:function(){return{pages:s["default"].map(this.article.pages,this._serializePage,this)}},unserialize:function(e){var t=[],i=new l["default"](null,this.article);return e="string"==typeof e?JSON.parse(e):e,s["default"].each(e.pages,function(e,n){e&&(e.pageNum=n,t.push(i.unserialize(e)))}),s["default"].each(t,function(e){this.article.pages[e.pageNum]=e,this.article.setTemplateForPageNum(e.template,e.pageNum)},this),this.article.revert(),this.article},_serializePage:function(e){var t=new l["default"](e,this.article);return t.serialize()}});exports["default"]=u},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(1),s=i(n),r=t(2),a=i(r),o=t(10),l=i(o),u=t(52),d=i(u),h=t(51),f=i(h),c=l["default"].extend({initialize:function(e,t){this.page=e,this.article=t},serialize:function(){var e=[],t=this.page;return this.article.overrideTemplates[t.pageNum]?(e=s["default"].map(t.pageTemplate.containers,function(e){return e.figureEl?{figureElementSignature:e.figureEl.signature,html:e.el.innerHTML}:null}),{template:{signature:t.template.signature,html:f["default"].getTemplateFromPageTemplate(t.pageTemplate).el.outerHTML},containers:e}):!1},unserialize:function(e){var t=e.template.signature,i=e.template.html,n=new d["default"]({el:(0,a["default"])(i)}),s=this._findOriginalTemplate(t);this.page=this.article.createPage(e.pageNum),this.page.setTemplate(s||n);var r=f["default"].getPageTemplateFromTemplate(n,{page:this.page});return this.page.setPageTemplate(r),this._restoreContainers(e),this.page},_findOriginalTemplate:function(e){return s["default"].find(this.article.templates,function(t){return t.matchesAnySignature(e)})},_restoreContainers:function(e){s["default"].each(this.page.pageTemplate.containers,function(t,i){var n=e.containers[i],s=n&&n.figureElementSignature;s&&(t.figureElSignature=s,t.saveState({html:n.html,renderedWidgets:!0}))})}});exports["default"]=c},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(34),s=i(n);exports["default"]={Article:s["default"]}},function(e,exports,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=t(31),s=i(n);exports["default"]={ScrollView:s["default"]}}])});